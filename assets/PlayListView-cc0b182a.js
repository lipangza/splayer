import{P as e,Q as a,_ as s,R as l,S as t,a8 as n,a7 as o,am as r,r as i,j as c,z as u,U as d,M as m,N as p,O as g,Y as v,a2 as k,W as h,X as y,ao as f,h as w,bs as L,bt as $,bu as b,at as j,bv as C,bw as _,ap as T,aA as P,aB as x,a1 as M,ad as U,Z as S,$ as q,ac as N,a6 as F,af as D,ag as H,aC as I,aJ as z,aD as W}from"./index-6137d952.js";import{D as E,M as R}from"./DataLists-f17a2567.js";import{P as B}from"./index-3e7b80bc.js";import{_ as V,g as A}from"./getCoverUrl-e2404558.js";import{M as O}from"./MusicList-6e01e0bb.js";import{P as Q}from"./People-93e58ed5.js";import{a as X,L as Z}from"./LinkTwo-053d5333.js";import{U as J}from"./Unlike-3687ca6d.js";import{_ as Y}from"./Skeleton-a194b938.js";import"./SmallSongData-fb959cbc.js";import"./InputNumber-5ee1c32b.js";import"./Add-a573bbfb.js";import"./FormItem-6e5a0af4.js";import"./ListAdd-05d5d0d1.js";import"./PlayOne-8b2c271b.js";import"./Select-3d3bcb8f.js";import"./Tooltip-8e4143df.js";import"./use-houdini-b4e30d74.js";const K=e("newlybuild",!0,(function(e){return a("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[a("path",{d:"M19 10V7C19 5.89543 19.8954 5 21 5H41C42.1046 5 43 5.89543 43 7V29C43 30.1046 42.1046 31 41 31H37",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),a("rect",{x:"5",y:"18",width:"24",height:"24",rx:"2",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),a("path",{d:"M17 25V35",stroke:e.colors[2],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),a("path",{d:"M12 30H22",stroke:e.colors[2],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null)])})),G=e("write",!0,(function(e){return a("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[a("path",{d:"M5.32497 43.4996L13.81 43.4998L44.9227 12.3871L36.4374 3.90186L5.32471 35.0146L5.32497 43.4996Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null),a("path",{d:"M27.9521 12.3872L36.4374 20.8725",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null)])})),ee={key:0,class:"playlist"},ae={class:"left"},se={class:"cover"},le={class:"meta"},te={class:"title"},ne={class:"intr"},oe={class:"name"},re={class:"desc text-hidden"},ie={class:"right"},ce={class:"meta"},ue={class:"num"},de={class:"num"},me={key:1,class:"title"},pe={class:"key"},ge=(e=>(D("data-v-1fd8e987"),e=e(),H(),e))((()=>g("br",null,null,-1))),ve={key:2,class:"loading"},ke={class:"left"},he={class:"right"},ye=s({__name:"PlayListView",setup(e){const{t:s}=l(),D=t(),H=n(),ye=o(),fe=r(),we=i(D.currentRoute.value.query.id),Le=i(null),$e=i([]),be=i(!1),je=i(30),Ce=i(!0),_e=i(D.currentRoute.value.query.page?Number(D.currentRoute.value.query.page):1),Te=i(0),Pe=e=>()=>w(N,{style:{transform:"translateX(2px)"}},{default:()=>e}),xe=e=>{const a=H.getUserPlayLists.like;return!a.length||!a.some((a=>a.id===Number(e)))},Me=e=>{const a=H.getUserPlayLists.own;return!!a.length&&a.some((a=>a.id===Number(e)))},Ue=i([]),Se=()=>{Ue.value=[{key:"copy",label:s("menu.copy",{name:s("general.name.playlist"),other:s("general.name.link")}),props:{onClick:()=>{if(navigator.clipboard)try{navigator.clipboard.writeText(`https://music.163.com/#/playlist?id=${we.value}`),$message.success(s("general.message.copySuccess"))}catch(e){console.error(s("general.message.copyFailure"),e),$message.error(s("general.message.copyFailure"))}else $message.error(s("general.message.notSupported"))}},icon:Pe(w(X))},{key:"del",label:s("menu.del"),show:H.userLogin&&Me(we.value),props:{onClick:()=>{De(Le.value)}},icon:Pe(w(L))},{key:"like",label:xe(we.value)?s("menu.collection",{name:s("general.name.playlist")}):s("menu.cancelCollection",{name:s("general.name.playlist")}),show:H.userLogin&&!Me(we.value),props:{onClick:()=>{He(we.value)}},icon:Pe(w(xe(we.value)?Z:J))}]},qe=e=>{$(e).then((e=>{Te.value=e.playlist.trackCount,Le.value=e.playlist,$setSiteTitle(e.playlist.name+" - "+s("general.name.playlist"))})).catch((e=>{$setSiteTitle(s("general.name.playlist")),Ce.value=!1,console.error($message.error(s("general.message.acquisitionFailed")),e),$message.error(s("general.message.acquisitionFailed"))}))},Ne=(e,a=30,l=0)=>{b(e,a,l).then((a=>{a.songs?($e.value=[],a.songs.forEach(((a,s)=>{$e.value.push({id:a.id,num:s+1+(_e.value-1)*je.value,name:a.name,artist:a.ar,album:a.al,alia:a.alia,time:j(a.dt),fee:a.fee,sourceId:e,pc:a.pc?a.pc:null,mv:a.mv?a.mv:null})}))):$message.error(s("general.message.acquisitionFailed")),"undefined"!=typeof $scrollToTop&&$scrollToTop()}))},Fe=()=>{try{const e=document.getElementById("datalists").firstElementChild,a=document.querySelectorAll("#datalists > *");let s=!1;if(a.forEach((e=>{e.classList.contains("play")&&(s=!0)})),s)ye.setPlayState(!0);else{const a=new MouseEvent("dblclick",{bubbles:!0,cancelable:!0,view:window});"dblclick"===fe.listClickMode?e.dispatchEvent(a):"click"===fe.listClickMode&&e.click()}}catch(e){console.error($message.error(s("general.message.operationFailed")),e),$message.error($message.error(s("general.message.operationFailed")))}},De=e=>{var a;if(e.id===(null==(a=H.getUserPlayLists)?void 0:a.own[0].id))return $message.warning(s("menu.unableToDelete")),!1;$dialog.warning({class:"s-dialog",title:s("general.dialog.delete"),content:s("menu.delQuestion",{name:e.name}),positiveText:s("general.dialog.delete"),negativeText:s("general.dialog.cancel"),onPositiveClick:()=>{C(e.id).then((e=>{200===e.code&&($message.success(s("general.message.deleteSuccess")),H.setUserPlayLists(),D.push("/user/playlists"))}))}})},He=async e=>{const a=xe(e)?1:2,l=s("general.name.playlist"),t="zh-CN"===fe.language?"":" ";try{200===(await _(a,e)).code?($message.success(`${l+t}${s(1==a?"menu.collection":"menu.cancelCollection",{name:s("general.dialog.success")})}`),H.setUserPlayLists((()=>{Se()}))):$message.error(`${l+t}${s(1==a?"menu.collection":"menu.cancelCollection",{name:s("general.dialog.failed")})}`)}catch(n){$message.error(`${l+t}${s(1==a?"menu.collection":"menu.cancelCollection",{name:s("general.dialog.failed")})}`),console.error(`${l+t}${s(1==a?"menu.collection":"menu.cancelCollection",{name:s("general.dialog.failed")})}`,n)}};c((()=>{we.value&&(qe(we.value),Ne(we.value,je.value,(_e.value-1)*je.value),!H.userLogin||H.getUserPlayLists.has||H.getUserPlayLists.isLoading?Se():H.setUserPlayLists((()=>{Se()})))}));const Ie=e=>{je.value=e,Ne(we.value,e,(_e.value-1)*je.value)},ze=e=>{D.push({path:"/playlist",query:{id:we.value,page:e}})};return u((()=>D.currentRoute.value),((e,a)=>{we.value=e.query.id,_e.value=Number(e.query.page?e.query.page:1),"playlist"==e.name&&(e.query.id!=a.query.id?(qe(we.value),Ne(we.value,je.value,(_e.value-1)*je.value)):Ne(we.value,je.value,(_e.value-1)*je.value))})),(e,s)=>{var l,t;const n=V,o=T,r=I,i=P,c=z,u=W,w=x,L=Y;return d(Le)?(m(),p("div",ee,[g("div",ae,[g("div",se,[a(n,{"show-toolbar-tooltip":"",class:"coverImg",src:d(A)(d(Le).coverImgUrl,1024),"previewed-img-props":{style:{borderRadius:"8px"}},"preview-src":d(A)(d(Le).coverImgUrl),"fallback-src":"/images/pic/default.png"},null,8,["src","preview-src"]),a(n,{"preview-disabled":"",class:"shadow",src:d(A)(d(Le).coverImgUrl,1024),"fallback-src":"/images/pic/default.png"},null,8,["src"])]),g("div",le,[g("div",te,[a(d(U),{class:"name text-hidden"},{default:v((()=>[M(k(d(Le).name),1)])),_:1}),a(d(U),{class:"creator"},{default:v((()=>[M(k(d(Le).creator.nickname),1)])),_:1})]),g("div",ne,[g("span",oe,k(e.$t("general.name.desc",{name:e.$t("general.name.playlist")})),1),g("span",re,k(d(Le).description?d(Le).description:e.$t("other.noDesc")),1),(null==(t=null==(l=d(Le))?void 0:l.description)?void 0:t.length)>70?(m(),h(o,{key:0,class:"all-desc",block:"",strong:"",secondary:"",onClick:s[0]||(s[0]=e=>be.value=!0)},{default:v((()=>[M(k(e.$t("general.name.allDesc")),1)])),_:1})):y("",!0)]),d(Le).tags?(m(),h(i,{key:0,class:"tag"},{default:v((()=>[(m(!0),p(S,null,q(d(Le).tags,(e=>(m(),h(r,{class:"tags",round:"",bordered:!1,key:e,onClick:a=>d(D).push(`/discover/playlists?cat=${e}&page=1`)},{default:v((()=>[M(k(e),1)])),_:2},1032,["onClick"])))),128))])),_:1})):y("",!0),a(i,{class:"control"},{default:v((()=>[a(o,{strong:"",secondary:"",round:"",type:"primary",onClick:Fe},{icon:v((()=>[a(d(N),{component:d(O)},null,8,["component"])])),default:v((()=>[M(" "+k(e.$t("general.name.play")),1)])),_:1}),a(c,{placement:"right-start",trigger:"click","show-arrow":!0,options:d(Ue)},{default:v((()=>[a(o,{strong:"",secondary:"",circle:""},{icon:v((()=>[a(d(N),{component:d(R)},null,8,["component"])])),_:1})])),_:1},8,["options"])])),_:1})])]),g("div",ie,[g("div",ce,[a(d(U),{class:"name"},{default:v((()=>[M(k(d(Le).name),1)])),_:1}),a(d(U),{class:"creator"},{default:v((()=>[a(d(N),{depth:3,component:d(Q)},null,8,["component"]),M(" "+k(d(Le).creator.nickname),1)])),_:1}),a(i,{class:"time"},{default:v((()=>[g("div",ue,[a(d(N),{depth:3,component:d(K)},null,8,["component"]),a(d(U),{innerHTML:d(F)(d(Le).createTime)},null,8,["innerHTML"])]),g("div",de,[a(d(N),{depth:3,component:d(G)},null,8,["component"]),a(d(U),{innerHTML:d(F)(d(Le).updateTime)},null,8,["innerHTML"])])])),_:1})]),a(E,{listData:d($e)},null,8,["listData"]),a(B,{totalCount:d(Te),pageNumber:d(_e),showSizePicker:!1,showQuickJumper:!1,onPageSizeChange:Ie,onPageNumberChange:ze},null,8,["totalCount","pageNumber"]),a(w,{class:"s-modal",show:d(be),"onUpdate:show":s[1]||(s[1]=e=>f(be)?be.value=e:null),preset:"card",title:e.$t("general.name.desc",{name:e.$t("general.name.playlist")}),bordered:!1},{default:v((()=>[a(u,null,{default:v((()=>[a(d(U),{innerHTML:d(Le).description.replace(/\n/g,"<br>")},null,8,["innerHTML"])])),_:1})])),_:1},8,["show","title"])])])):d(we)&&d(Ce)?(m(),p("div",ve,[g("div",ke,[a(L,{class:"pic"}),a(L,{text:"",repeat:5}),a(L,{text:"",style:{width:"60%"}})]),g("div",he,[a(L,{sharp:!1,height:"80px",width:"60%"}),a(L,{height:"100%",width:"100%"})])])):(m(),p("div",me,[g("span",pe,k(d(Ce)?e.$t("general.name.noKeywords"):e.$t("general.message.acquisitionFailed")),1),ge,a(o,{strong:"",secondary:"",onClick:s[2]||(s[2]=e=>d(D).go(-1)),style:{"margin-top":"20px"}},{default:v((()=>[M(k(e.$t("general.name.goBack")),1)])),_:1})]))}}},[["__scopeId","data-v-1fd8e987"]]);export{ye as default};
