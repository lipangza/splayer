import{_ as a}from"./SongList-CDQnjgGa.js";import{d as e,as as s,b as l,r as t,L as i,f as o,bI as n,Z as c,cW as u,T as d,S as r,R as v,o as p,H as m,j as g,n as f,m as y,k as h,J as k,ag as _,ah as b,cN as L,a5 as w,a8 as S,cU as T,cT as C,a7 as x,b9 as I,i as j,af as $,cl as P,ar as R,ai as U,cV as z,aA as H,aB as q,aI as B,a6 as N,c5 as A,aq as D,ao as E,aj as J,ae as K,b4 as O,ac as V,c_ as W,cy as X,X as Z,b8 as F,aR as G,aS as M,c$ as Q,K as Y}from"./stores-fvLrIm8G.js";import{u as aa,d as ea,e as sa,p as la,b as ta}from"./index-CugtlCeX.js";const ia={key:0,class:"detail"},oa={class:"cover"},na={class:"play-count"},ca={class:"num"},ua={class:"data"},da={class:"item"},ra={key:0,class:"item"},va={key:1,class:"item"},pa={key:2,class:"item"},ma={key:1,class:"detail"},ga={class:"data"},fa=Y(e({__name:"liked",setup(e){const Y=aa(),fa=s(),ya=l(),ha=t(!1),ka=i([]),_a=t(null),ba=t(""),La=t([]),wa=o(()=>fa.userLikeData.playlists?.[0]?.id),Sa=t(!0),Ta=t(null),Ca=t(!1),xa=o(()=>ba.value?La.value:ka.value),Ia=o(()=>ya.mainContentHeight-(Ca.value?120:240)),ja=o(()=>"like-songs"===Y.currentRoute.value.name),$a=o(()=>[{label:"编辑歌单",key:"edit",props:{onClick:()=>{_a.value&&wa.value&&sa(wa.value,_a.value,()=>Pa(wa.value,{getList:!1,refresh:!1}))}},icon:n("EditNote")},{label:"批量操作",key:"batch",props:{onClick:()=>ea(xa.value,!1,wa.value)},icon:n("Batch")},{label:"打开源页面",key:"open",props:{onClick:()=>{window.open(`https://music.163.com/#/playlist?id=${wa.value}`)}},icon:n("Link")}]),Pa=async(a,e={getList:!0,refresh:!1})=>{if(!a)return;Sa.value=!0;const{getList:s,refresh:l}=e;Ba(),l||Ra(s),Ua(a,s,l)},Ra=a=>{_a.value=null,a&&(ka.value=[],Ca.value=!1)},Ua=async(a,e,s)=>{za();const l=await W(a);if(_a.value=X(l.playlist)[0],e&&0!==_a.value.count){if(1===Z()&&_a.value?.count<800){const a=l.privileges.map(a=>a.id),e=await F(a);ka.value=G(e.songs)}else await Ha(a,_a.value.count||0,s);fa.setLikeSongsList(_a.value,ka.value),Sa.value=!1}else Sa.value=!1},za=()=>{M(fa.likeSongsList.detail)&&(_a.value=fa.likeSongsList.detail),fa.likeSongsList.data.length&&(ka.value=fa.likeSongsList.data)},Ha=async(a,e,s=!1)=>{Sa.value=!0,Da(!s);let l=0;const t=[];do{const e=await Q(a,500,l),i=G(e.songs);t.push(...i),s||(ka.value=ka.value.concat(i)),l+=500}while(l<e&&ja.value);s&&(ka.value=t),Da(!1)},qa=a=>{const e=a.target.scrollTop;Ca.value=e>10},Ba=()=>{ba.value="",La.value=[]},Na=c(()=>{_a.value&&ka.value?.length&&la.updatePlayList(ka.value,void 0,wa.value)},300),Aa=c(a=>{if(!(a=a.trim())||""===a)return;const e=u(a,ka.value);La.value=e},300),Da=(a=!0)=>{a?(Ta.value?.destroy(),Ta.value=window.$message.loading("该歌单歌曲数量过多，请稍等",{duration:0,closable:!0})):(Sa.value=!1,Ta.value?.destroy(),Ta.value=null)},Ea=a=>{ka.value&&(ka.value=ka.value.filter(e=>!a.includes(e.id)))};return d(()=>{ha.value?Pa(wa.value,{getList:!0,refresh:!0}):ha.value=!0}),r(()=>Da(!1)),v(()=>Da(!1)),p(async()=>{const a=await fa.getUserLikePlaylist(),e=a?.detail?.id;e&&Pa(e)}),(e,s)=>{const l=_,t=w,i=C,o=P,n=U,c=B,u=R,d=I,r=N,v=A,p=D,W=J,X=a,Z=O;return g(),m("div",{class:V(["liked",{small:h(Ca)}])},[f(K,{name:"fade",mode:"out-in"},{default:y(()=>[h(_a)?(g(),m("div",ia,[k("div",oa,[f(l,{src:h(_a).coverSize?.m||h(_a).cover,"previewed-img-props":{style:{borderRadius:"8px"}},"preview-src":h(_a).cover,renderToolbar:h(L),"show-toolbar-tooltip":"",class:"cover-img",onLoad:h(b)},{placeholder:y(()=>s[1]||(s[1]=[k("div",{class:"cover-loading"},[k("img",{src:ta,class:"loading-img",alt:"loading-img"})],-1)])),_:1},8,["src","preview-src","renderToolbar","onLoad"]),f(l,{class:"cover-shadow","preview-disabled":"",src:h(_a).coverSize?.m||h(_a).cover},null,8,["src"]),s[2]||(s[2]=k("div",{class:"cover-mask"},null,-1)),k("div",na,[f(t,{name:"Play"}),k("span",ca,S(h(T)(h(_a).playCount||0)),1)])]),k("div",ua,[f(i,{class:"name text-hidden"},{default:y(()=>s[3]||(s[3]=[x(" 我喜欢的音乐 ")])),_:1,__:[3]}),f(d,{show:!h(Ca),class:"collapse"},{default:y(()=>[h(_a).description?(g(),j(o,{key:0,"line-clamp":1,tooltip:{trigger:"click",placement:"bottom",width:"trigger"}},{default:y(()=>[x(S(h(_a).description),1)]),_:1})):$("",!0),f(u,{class:"meta"},{default:y(()=>[k("div",da,[f(t,{name:"Person",depth:3}),f(n,null,{default:y(()=>[x(S(h(_a).creator?.name||"未知用户名"),1)]),_:1})]),h(_a).updateTime?(g(),m("div",ra,[f(t,{name:"Update",depth:3}),f(n,null,{default:y(()=>[x(S(h(z)(h(_a).updateTime)),1)]),_:1})])):h(_a).createTime?(g(),m("div",va,[f(t,{name:"Time",depth:3}),f(n,null,{default:y(()=>[x(S(h(z)(h(_a).createTime)),1)]),_:1})])):$("",!0),h(_a).tags?.length?(g(),m("div",pa,[f(t,{name:"Tag",depth:3}),f(u,{class:"tags"},{default:y(()=>[(g(!0),m(H,null,q(h(_a).tags,(a,e)=>(g(),j(c,{key:e,bordered:!1,round:"",onClick:e=>h(Y).push({name:"discover-playlists",query:{cat:a}})},{default:y(()=>[x(S(a),1)]),_:2},1032,["onClick"]))),128))]),_:1})])):$("",!0)]),_:1})]),_:1},8,["show"]),f(u,{class:"menu",justify:"space-between"},{default:y(()=>[f(u,{class:"left",align:"flex-end"},{default:y(()=>[f(r,{focusable:!1,disabled:h(Sa),loading:h(Sa),type:"primary",strong:"",secondary:"",round:"",onClick:h(Na)},{icon:y(()=>[f(t,{name:"Play"})]),default:y(()=>[x(" "+S(h(Sa)?`正在更新... (${h(ka).length===h(_a).count?0:h(ka).length}/${h(_a).count})`:"播放"),1)]),_:1},8,["disabled","loading","onClick"]),f(v,{options:h($a),trigger:"click",placement:"bottom-start"},{default:y(()=>[f(r,{focusable:!1,class:"more",circle:"",strong:"",secondary:""},{icon:y(()=>[f(t,{name:"List"})]),_:1})]),_:1},8,["options"])]),_:1}),f(u,{class:"right"},{default:y(()=>[h(ka)?.length?(g(),j(p,{key:0,value:h(ba),"onUpdate:value":s[0]||(s[0]=a=>E(ba)?ba.value=a:null),"input-props":{autocomplete:"off"},class:"search",placeholder:"模糊搜索",clearable:"",round:"",onInput:h(Aa)},{prefix:y(()=>[f(t,{name:"Search"})]),_:1},8,["value","onInput"])):$("",!0)]),_:1})]),_:1})])])):(g(),m("div",ma,[f(W,{class:"cover"}),k("div",ga,[f(W,{repeat:4,text:""})])]))]),_:1}),f(K,{name:"fade",mode:"out-in"},{default:y(()=>[!h(ba)||h(La)?.length?(g(),j(X,{key:0,data:h(xa),loading:h(Sa),height:h(Ia),playListId:h(wa),onScroll:qa,onRemoveSong:Ea},null,8,["data","loading","height","playListId"])):(g(),j(Z,{key:1,description:`搜不到关于 ${h(ba)} 的任何歌曲呀`,style:{"margin-top":"60px"},size:"large"},{icon:y(()=>[f(t,{name:"SearchOff"})]),_:1},8,["description"]))]),_:1})],2)}}}),[["__scopeId","data-v-7eef6253"]]);export{fa as default};
