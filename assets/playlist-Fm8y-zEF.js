import{_ as a}from"./SongList-CDQnjgGa.js";import{d as e,as as l,b as s,L as t,r as i,f as o,bI as n,Z as c,cW as u,cX as r,b0 as d,cY as v,T as p,S as m,R as g,o as y,H as f,j as h,n as k,m as w,k as _,J as b,ag as L,ah as C,cN as T,a5 as x,a8 as $,cU as S,cT as I,a7 as P,i as R,af as j,bR as D,ai as q,b9 as z,cl as N,ar as B,cV as H,aA as U,aB as E,aI as F,a6 as O,cZ as X,c5 as Z,aq as A,ao as J,aj as K,ae as V,b4 as W,ac as Y,c_ as G,cy as M,X as Q,b8 as aa,aR as ea,c$ as la,K as sa}from"./stores-fvLrIm8G.js";import{u as ta,d as ia,p as oa,o as na,b as ca,e as ua}from"./index-CugtlCeX.js";const ra={key:0,class:"detail"},da={class:"cover"},va={class:"play-count"},pa={class:"num"},ma={class:"data"},ga={class:"item"},ya={key:0,class:"item"},fa={key:1,class:"item"},ha={key:2,class:"item"},ka={key:1,class:"detail"},wa={class:"data"},_a=sa(e({__name:"playlist",setup(e){const sa=ta(),_a=l(),ba=s(),La=t([]),Ca=i(null),Ta=i(""),xa=i([]),$a=i(0),Sa=o(()=>Number(sa.currentRoute.value.query.id)),Ia=i(!0),Pa=i(null),Ra=i(!1),ja=o(()=>Ta.value?xa.value:La.value),Da=o(()=>ba.mainContentHeight-(Ra.value?120:240)),qa=o(()=>Ca.value?.creator?.id===_a.userData?.userId),za=o(()=>_a.userLikeData.playlists.some(a=>a.id===Ca.value?.id)),Na=o(()=>"playlist"===sa.currentRoute.value.name),Ba=o(()=>$a.value===Sa.value),Ha=o(()=>[{label:"公开隐私歌单",key:"privacy",show:10===Ca.value?.privacy,props:{onClick:Ma},icon:n("ListLockOpen")},{label:"删除歌单",key:"delete",show:qa.value,props:{onClick:()=>Wa()},icon:n("Delete")},{label:"批量操作",key:"batch",props:{onClick:()=>ia(ja.value,!1,qa.value?Sa.value:void 0)},icon:n("Batch")},{label:"打开源页面",key:"open",props:{onClick:()=>{window.open(`https://music.163.com/#/playlist?id=${Sa.value}`)}},icon:n("Link")}]),Ua=async(a,e={getList:!0,refresh:!1})=>{if(!a)return;Ia.value=!0;const{getList:l,refresh:s}=e;Aa(),s||Ea(l);16===a.toString().length?Fa(a):await Oa(a,l,s)},Ea=a=>{Ca.value=null,a&&(La.value=[],Ra.value=!1)},Fa=a=>{},Oa=async(a,e,l)=>{const s=await G(a);Ca.value=M(s.playlist)[0];const t=Ca.value?.count||0;if(e&&0!==t){if(1===Q()&&t===s.privileges?.length&&t<800){const a=s.privileges.map(a=>a.id),e=await aa(a);La.value=ea(e.songs)}else await Xa(a,t,l);Ia.value=!1}else Ia.value=!1},Xa=async(a,e,l=!1)=>{Ia.value=!0,Ja(!l,e);let s=0;const t=[];do{const e=await la(a,500,s),i=ea(e.songs);t.push(...i),l||(La.value=La.value.concat(i)),s+=500}while(s<e&&Na.value);l&&(La.value=t),Ja(!1)},Za=a=>{const e=a.target.scrollTop;Ra.value=e>10},Aa=()=>{Ta.value="",xa.value=[]},Ja=(a=!0,e)=>{if(a){if(e&&e<=800)return;Pa.value?.destroy(),Pa.value=window.$message.loading("该歌单歌曲数量过多，请稍等",{duration:0,closable:!0})}else Pa.value?.destroy(),Pa.value=null},Ka=c(()=>{Ca.value&&La.value?.length&&oa.updatePlayList(La.value,void 0,Sa.value)},300),Va=c(a=>{if(!(a=a.trim())||""===a)return;const e=u(a,La.value);xa.value=e},300),Wa=async()=>{Ca.value&&Sa.value&&window.$dialog.warning({title:"删除歌单",content:"确认删除这个歌单？该操作无法撤销！",positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{200===(await r(Sa.value)).code&&(window.$message.success("歌单删除成功"),_a.userData.createdPlaylistCount&&(_a.userData.createdPlaylistCount-=1,await d()))}})},Ya=a=>{La.value&&(La.value=La.value.filter(e=>!a.includes(e.id)))},Ga=()=>{Ca.value&&Sa.value&&ua(Sa.value,Ca.value,()=>Ua(Sa.value,{getList:!1,refresh:!1}))},Ma=async()=>{10===Ca.value?.privacy&&window.$dialog.warning({title:"公开隐私歌单",content:"确认公开这个歌单？该操作无法撤销！",positiveText:"公开",negativeText:"取消",onPositiveClick:async()=>{200===(await v(Sa.value)).code&&(Ca.value&&(Ca.value.privacy=0),window.$message.success("歌单公开成功"))}})};return na(a=>{const e=Number(a.query.id);e&&($a.value=e,Ua(e))}),p(()=>{if(0===$a.value)$a.value=Sa.value;else{const a=$a.value===Sa.value;$a.value=Sa.value,Ua(Sa.value,{getList:!0,refresh:a})}}),m(()=>Ja(!1)),g(()=>Ja(!1)),y(()=>Ua(Sa.value)),(e,l)=>{const s=L,t=x,i=q,o=D,n=I,c=N,u=F,r=B,d=z,v=O,p=Z,m=A,g=K,y=a,G=W;return h(),f("div",{class:Y(["playlist",{small:_(Ra)}])},[k(V,{name:"fade",mode:"out-in"},{default:w(()=>[_(Ca)?(h(),f("div",ra,[b("div",da,[k(s,{src:_(Ca).coverSize?.m||_(Ca).cover,"previewed-img-props":{style:{borderRadius:"8px"}},"preview-src":_(Ca).cover,renderToolbar:_(T),"show-toolbar-tooltip":"",class:"cover-img",onLoad:_(C)},{placeholder:w(()=>l[2]||(l[2]=[b("div",{class:"cover-loading"},[b("img",{src:ca,class:"loading-img",alt:"loading-img"})],-1)])),_:1},8,["src","preview-src","renderToolbar","onLoad"]),k(s,{class:"cover-shadow","preview-disabled":"",src:_(Ca).coverSize?.m||_(Ca).cover},null,8,["src"]),l[3]||(l[3]=b("div",{class:"cover-mask"},null,-1)),b("div",va,[k(t,{name:"Play"}),b("span",pa,$(_(S)(_(Ca).playCount||0)),1)])]),b("div",ma,[k(n,{class:"name text-hidden"},{default:w(()=>[P($(_(Ca).name||"未知歌单")+" ",1),10===_(Ca)?.privacy?(h(),R(o,{key:0,"show-arrow":!1,placement:"right"},{trigger:w(()=>[k(t,{depth:3,name:"EyeLock",size:"22"})]),default:w(()=>[k(i,null,{default:w(()=>l[4]||(l[4]=[P("隐私歌单")])),_:1,__:[4]})]),_:1})):j("",!0)]),_:1}),k(d,{show:!_(Ra),class:"collapse"},{default:w(()=>[_(Ca).description?(h(),R(c,{key:0,"line-clamp":1,tooltip:{trigger:"click",placement:"bottom",width:"trigger"}},{default:w(()=>[P($(_(Ca).description),1)]),_:1})):j("",!0),k(r,{class:"meta"},{default:w(()=>[b("div",ga,[k(t,{name:"Person",depth:3}),k(i,null,{default:w(()=>[P($(_(Ca).creator?.name||"未知用户名"),1)]),_:1})]),_(Ca).updateTime?(h(),f("div",ya,[k(t,{name:"Update",depth:3}),k(i,null,{default:w(()=>[P($(_(H)(_(Ca).updateTime)),1)]),_:1})])):_(Ca).createTime?(h(),f("div",fa,[k(t,{name:"Time",depth:3}),k(i,null,{default:w(()=>[P($(_(H)(_(Ca).createTime)),1)]),_:1})])):j("",!0),_(Ca).tags?.length?(h(),f("div",ha,[k(t,{name:"Tag",depth:3}),k(r,{class:"tags"},{default:w(()=>[(h(!0),f(U,null,E(_(Ca).tags,(a,e)=>(h(),R(u,{key:e,bordered:!1,round:"",onClick:e=>_(sa).push({name:"discover-playlists",query:{cat:a}})},{default:w(()=>[P($(a),1)]),_:2},1032,["onClick"]))),128))]),_:1})])):j("",!0)]),_:1})]),_:1},8,["show"]),k(r,{class:"menu",justify:"space-between"},{default:w(()=>[k(r,{class:"left",align:"flex-end"},{default:w(()=>[k(v,{focusable:!1,disabled:_(Ia),loading:_(Ia),type:"primary",strong:"",secondary:"",round:"",onClick:_(Ka)},{icon:w(()=>[k(t,{name:"Play"})]),default:w(()=>[P(" "+$(_(Ia)?_(Ba)?"更新中...":`加载中... (${_(La).length===_(Ca).count?0:_(La).length}/${_(Ca).count})`:"播放"),1)]),_:1},8,["disabled","loading","onClick"]),_(qa)?(h(),R(v,{key:0,focusable:!1,strong:"",secondary:"",round:"",onClick:Ga},{icon:w(()=>[k(t,{name:"EditNote"})]),default:w(()=>[l[5]||(l[5]=P(" 编辑歌单 "))]),_:1,__:[5]})):(h(),R(v,{key:1,focusable:!1,strong:"",secondary:"",round:"",onClick:l[0]||(l[0]=a=>_(X)(_(Sa),!_(za)))},{icon:w(()=>[k(t,{name:_(za)?"Favorite":"FavoriteBorder"},null,8,["name"])]),default:w(()=>[P(" "+$(_(za)?"取消收藏":"收藏歌单"),1)]),_:1})),k(p,{options:_(Ha),trigger:"click",placement:"bottom-start"},{default:w(()=>[k(v,{focusable:!1,class:"more",circle:"",strong:"",secondary:""},{icon:w(()=>[k(t,{name:"List"})]),_:1})]),_:1},8,["options"])]),_:1}),k(r,{class:"right"},{default:w(()=>[_(La)?.length?(h(),R(m,{key:0,value:_(Ta),"onUpdate:value":l[1]||(l[1]=a=>J(Ta)?Ta.value=a:null),"input-props":{autocomplete:"off"},class:"search",placeholder:"模糊搜索",clearable:"",round:"",onInput:_(Va)},{prefix:w(()=>[k(t,{name:"Search"})]),_:1},8,["value","onInput"])):j("",!0)]),_:1})]),_:1})])])):(h(),f("div",ka,[k(g,{class:"cover"}),b("div",wa,[k(g,{repeat:4,text:""})])]))]),_:1}),k(V,{name:"fade",mode:"out-in"},{default:w(()=>[!_(Ta)||_(xa)?.length?(h(),R(y,{key:0,data:_(ja),loading:_(Ia),height:_(Da),playListId:_(Sa),onScroll:Za,onRemoveSong:Ya},null,8,["data","loading","height","playListId"])):(h(),R(G,{key:1,description:`搜不到关于 ${_(Ta)} 的任何歌曲呀`,style:{"margin-top":"60px"},size:"large"},{icon:w(()=>[k(t,{name:"SearchOff"})]),_:1},8,["description"]))]),_:1})],2)}}}),[["__scopeId","data-v-a10a8295"]]);export{_a as default};
