import{_ as a}from"./SongList-DPr6dAOg.js";import{a7 as e,s,r as t,f as l,n as o,g as r,G as c,k as n,j as i,T as d,O as u,aa as p,a1 as m,J as v,P as f,R as y,i as g,L as _,W as k,Y as h,ah as b,aC as j,at as w,b1 as $,aJ as z,au as x,ad as C,a0 as L,ap as T,aq as q,v as R}from"./vendor-QWMq--4w.js";import{_ as I,g as O,q as S,K as U,e as D,B as J,d as P,F as B,i as F,f as G}from"./index-B903CxKP.js";import{a as K,b as N,l as Q}from"./dj-DH2T3qaa.js";import"./Pagination-D96eRF_4.js";const W={key:0,class:"dj"},Y={key:0,class:"detail"},A={class:"cover"},E=(a=>(T("data-v-ace1c205"),a=a(),q(),a))((()=>v("div",{class:"cover-loading"},[v("img",{class:"loading-img",src:G,alt:"song"})],-1))),H={class:"data"},M={class:"creator"},V={key:0,class:"num-item"},X={key:1,class:"num-item"},Z={key:1,class:"detail"},aa={class:"data"},ea={key:0,class:"list"},sa={key:0,class:"song-list"},ta={key:1,class:"title"},la=I({__name:"dj",setup(T){const q=e(),I=O(),{userLikeData:G}=s(I),la=t(q.currentRoute.value.query.id),oa=t(null),ra=t(null),ca=t(null),na=t(null),ia=t([]),da=[{label:"打开源页面链接",key:"open",props:{onclick:()=>{const a=la.value;a&&window.open(`https://music.163.com/#/djradio?id=${a}`)}},icon:(ua="link",()=>R(k,null,{default:()=>R(D,{icon:ua},null)}))}];var ua;const pa=async(a,e)=>{try{if(0===e)return ra.value="empty";e>=500&&(ca.value=$message.loading("该电台节目数量过多，请稍等",{duration:0}));let s=0;for(ra.value=[];null===e||s<e;){const e=await N(a,500,s),t=S(e.programs,"dj");ra.value=ra.value.concat(t),s+=500}ca.value?.destroy(),ca.value=null}catch(s){console.error("获取电台节目错误：",s),$message.error("获取电台节目出现错误")}},ma=P((a=>{const e=a?.trim();if(!e||""===e)return!0;const s=B(e,ra.value);ia.value=s}),300),va=a=>{const e=G.value.djs;return!e.length||!e.some((e=>e.id===Number(a)))},fa=P((async a=>{try{if(!F())return $message.warning("请登录后使用");const e=va(a)?1:0;200===(await Q(a,e)).code?($message.success((1===e?"订阅":"取消订阅")+"成功"),await I.setUserLikeDjs()):$message.error((1===e?"订阅":"取消订阅")+"失败，请重试")}catch(e){console.error("订阅出错：",e),$message.error("订阅操作出现错误")}}),300);return l((async()=>{await(async a=>{try{if(!a)return!1;oa.value=null,ra.value=null;const e=await K(a);oa.value=S(e.data,"dj")[0],await pa(la.value,oa.value?.count)}catch(e){console.error("获取电台信息出错：",e),$message.error("获取电台信息出现错误")}})(la.value)})),(e,s)=>{const t=b,l=u,T=j,R=w,I=$,O=p,S=z,P=m,B=x,F=C,G=a,K=L;return o(la)?(r(),c("div",W,[n(d,{name:"fade",mode:"out-in"},{default:i((()=>[o(oa)&&Object.keys(o(oa))?.length?(r(),c("div",Y,[v("div",A,[n(t,{src:o(oa).coverSize.l,"previewed-img-props":{style:{borderRadius:"8px"}},"preview-src":o(oa).cover,class:"cover-img","show-toolbar-tooltip":"",onLoad:s[0]||(s[0]=a=>{a.target.style.opacity=1})},{placeholder:i((()=>[E])),_:1},8,["src","preview-src"]),n(t,{src:o(oa).coverSize.m,class:"cover-shadow","preview-disabled":""},null,8,["src"])]),v("div",H,[n(l,{class:"name"},{default:i((()=>[f(y(o(oa).name||"未知电台"),1)])),_:1}),v("div",M,[n(T,{src:(o(oa).creator?.avatarUrl+"?param=300y$300").replace(/^http:/,"https:"),"fallback-src":"/images/pic/avatar.jpg?assest",round:""},null,8,["src"]),n(l,{class:"nickname"},{default:i((()=>[f(y(o(oa).creator?.nickname||"未知创建者"),1)])),_:1}),o(oa).createTime?(r(),g(l,{key:0,class:"create-time",depth:"3"},{default:i((()=>[f(y(o(U)(o(oa).createTime))+" 创建 ",1)])),_:1})):_("",!0),o(oa)?.tags?(r(),g(R,{key:1,bordered:!1,class:"tags",round:"",onClick:s[1]||(s[1]=a=>o(q).push({path:"/dj-type",query:{type:o(oa).tags.id,name:o(oa).tags.name}}))},{default:i((()=>[f(y(o(oa).tags.name),1)])),_:1})):_("",!0)]),o(oa).desc?(r(),g(I,{key:0,tooltip:!1,class:"description","expand-trigger":"click","line-clamp":"2"},{default:i((()=>[n(l,{depth:"3"},{default:i((()=>[f(y(o(oa).desc),1)])),_:1})])),_:1})):(r(),g(l,{key:1,class:"description"},{default:i((()=>[f("太懒了吧，连简介都没写")])),_:1})),n(O,{class:"num"},{default:i((()=>[o(oa)?.count?(r(),c("div",V,[n(o(k),{depth:"3",size:"18"},{default:i((()=>[n(o(D),{icon:"music-note"})])),_:1}),n(l,{depth:"3"},{default:i((()=>[f(y(o(oa).count),1)])),_:1})])):_("",!0),o(oa)?.updateTime?(r(),c("div",X,[n(o(k),{depth:"3",size:"18"},{default:i((()=>[n(o(D),{icon:"clock"})])),_:1}),n(l,{depth:"3"},{default:i((()=>[f(y(o(U)(o(oa).updateTime))+" 更新",1)])),_:1})])):_("",!0)])),_:1})])])):(r(),c("div",Z,[n(S,{class:"cover"}),v("div",aa,[n(S,{repeat:4,text:""})])]))])),_:1}),n(O,{class:"menu",justify:"space-between"},{default:i((()=>[n(O,{class:"left"},{default:i((()=>[n(P,{disabled:"empty"===o(ra),focusable:!1,type:"primary",class:"play",tag:"div",circle:"",strong:"",secondary:"",onClick:s[2]||(s[2]=a=>o(J)(o(ra),"dj"))},{icon:i((()=>[n(o(k),{size:"32"},{default:i((()=>[n(o(D),{icon:"play-arrow-rounded"})])),_:1})])),_:1},8,["disabled"]),n(P,{focusable:!1,class:"like",size:"large",tag:"div",round:"",strong:"",secondary:"",onClick:s[3]||(s[3]=a=>o(fa)(o(la)))},{icon:i((()=>[n(o(k),null,{default:i((()=>[n(o(D),{icon:va(o(la))?"favorite-outline-rounded":"favorite-rounded"},null,8,["icon"])])),_:1})])),default:i((()=>[f(" "+y(va(o(la))?"订阅电台":"取消订阅"),1)])),_:1}),n(B,{options:da,trigger:"hover",placement:"bottom-start"},{default:i((()=>[n(P,{focusable:!1,class:"more",size:"large",tag:"div",circle:"",strong:"",secondary:""},{icon:i((()=>[n(o(k),null,{default:i((()=>[n(o(D),{icon:"format-list-bulleted"})])),_:1})])),_:1})])),_:1})])),_:1}),n(O,{class:"right"},{default:i((()=>[n(d,{name:"fade",mode:"out-in"},{default:i((()=>["empty"!==o(ra)&&o(ra)?.length?(r(),g(F,{key:0,value:o(na),"onUpdate:value":s[4]||(s[4]=a=>h(na)?na.value=a:null),"input-props":{autoComplete:!1},class:"search",placeholder:"模糊搜索",clearable:"",onInput:o(ma)},{prefix:i((()=>[n(o(k),{size:"18"},{default:i((()=>[n(o(D),{icon:"search-rounded"})])),_:1})])),_:1},8,["value","onInput"])):_("",!0)])),_:1})])),_:1})])),_:1}),n(d,{name:"fade",mode:"out-in"},{default:i((()=>["empty"!==o(ra)?(r(),c("div",ea,[n(d,{name:"fade",mode:"out-in"},{default:i((()=>[o(na)?o(ia)?.length?(r(),g(G,{key:1,data:o(ia),type:"dj"},null,8,["data"])):(r(),g(K,{key:2,description:`搜不到关于 ${o(na)} 的任何节目`,style:{"margin-top":"60px"},size:"large"},{icon:i((()=>[n(o(k),null,{default:i((()=>[n(o(D),{icon:"search-off"})])),_:1})])),_:1},8,["description"])):(r(),c("div",sa,[n(G,{data:o(ra),type:"dj"},null,8,["data"])]))])),_:1})])):(r(),g(K,{key:1,class:"empty",description:"这个电台还没有节目哦"}))])),_:1})])):(r(),c("div",ta,[n(l,{class:"key"},{default:i((()=>[f("参数不完整")])),_:1}),n(P,{focusable:!1,class:"back",strong:"",secondary:"",onClick:s[5]||(s[5]=a=>o(q).go(-1))},{default:i((()=>[f(" 返回上一页 ")])),_:1})]))}}},[["__scopeId","data-v-ace1c205"]]);export{la as default};
