import{_ as a}from"./SongList-aTQiyLTJ.js";import{d as e,as as s,b as l,L as t,r as i,f as o,Z as n,cX as c,S as u,R as r,Q as d,o as v,H as p,k as m,j as g,af as y,ac as f,m as h,cY as k,cz as w,X as b,b8 as _,aR as L,cZ as C,h as T,I as x,cP as $,ad as P,a2 as S,cU as I,a1 as j,i as R,ae as z,cV as D,aA as q,aB as U,c_ as B,am as H,bJ as N,c$ as E,b0 as F,d0 as O,ai as X,a8 as Z,aj as A,bU as J,cW as K,cm as Q,aI as V,ar as W,b9 as Y,aa as G,c6 as M,aq as aa,ak as ea,b4 as sa,K as la}from"./stores-Jq5HPlpq.js";import{u as ta,p as ia,o as oa,b as na,d as ca,e as ua}from"./index-CrsIAaLK.js";const ra={key:0,class:"detail"},da={class:"cover"},va={class:"play-count"},pa={class:"num"},ma={class:"data"},ga={class:"item"},ya={key:0,class:"item"},fa={key:1,class:"item"},ha={key:2,class:"item"},ka={key:1,class:"detail"},wa={class:"data"},ba=la(e({__name:"playlist",setup(e){const la=ta(),ba=s(),_a=l(),La=t([]),Ca=i(null),Ta=i(""),xa=i([]),$a=i(0),Pa=o((()=>Number(la.currentRoute.value.query.id))),Sa=i(!0),Ia=i(null),ja=i(!1),Ra=o((()=>Ta.value?xa.value:La.value)),za=o((()=>_a.mainContentHeight-(ja.value?120:240))),Da=o((()=>Ca.value?.creator?.id===ba.userData?.userId)),qa=o((()=>ba.userLikeData.playlists.some((a=>a.id===Ca.value?.id)))),Ua=o((()=>"playlist"===la.currentRoute.value.name)),Ba=o((()=>$a.value===Pa.value)),Ha=o((()=>[{label:"公开隐私歌单",key:"privacy",show:10===Ca.value?.privacy,props:{onClick:Ga},icon:N("ListLockOpen")},{label:"删除歌单",key:"delete",show:Da.value,props:{onClick:()=>Va()},icon:N("Delete")},{label:"批量操作",key:"batch",props:{onClick:()=>ca(Ra.value,!1,Da.value?Pa.value:void 0)},icon:N("Batch")},{label:"打开源页面",key:"open",props:{onClick:()=>{window.open(`https://music.163.com/#/playlist?id=${Pa.value}`)}},icon:N("Link")}])),Na=async(a,e={getList:!0,refresh:!1})=>{if(!a)return;Sa.value=!0;const{getList:s,refresh:l}=e;Aa(),l||Ea(s);16===a.toString().length?Fa(a):await Oa(a,s,l)},Ea=a=>{Ca.value=null,a&&(La.value=[],ja.value=!1)},Fa=a=>{},Oa=async(a,e,s)=>{const l=await k(a);Ca.value=w(l.playlist)[0];const t=Ca.value?.count||0;if(e&&0!==t){if(1===b()&&t===l.privileges?.length&&t<800){const a=l.privileges.map((a=>a.id)),e=await _(a);La.value=L(e.songs)}else await Xa(a,t,s);Sa.value=!1}else Sa.value=!1},Xa=async(a,e,s=!1)=>{Sa.value=!0,Ja(!s,e);let l=0;const t=[];do{const e=await C(a,500,l),i=L(e.songs);t.push(...i),s||(La.value=La.value.concat(i)),l+=500}while(l<e&&Ua.value);s&&(La.value=t),Ja(!1)},Za=a=>{const e=a.target.scrollTop;ja.value=e>10},Aa=()=>{Ta.value="",xa.value=[]},Ja=(a=!0,e)=>{if(a){if(e&&e<=800)return;Ia.value?.destroy(),Ia.value=window.$message.loading("该歌单歌曲数量过多，请稍等",{duration:0,closable:!0})}else Ia.value?.destroy(),Ia.value=null},Ka=n((()=>{Ca.value&&La.value?.length&&ia.updatePlayList(La.value,void 0,Pa.value)}),300),Qa=n((a=>{if(!(a=a.trim())||""===a)return;const e=c(a,La.value);xa.value=e}),300),Va=async()=>{Ca.value&&Pa.value&&window.$dialog.warning({title:"删除歌单",content:"确认删除这个歌单？该操作无法撤销！",positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{200===(await E(Pa.value)).code&&(window.$message.success("歌单删除成功"),ba.userData.createdPlaylistCount&&(ba.userData.createdPlaylistCount-=1,await F()))}})},Wa=a=>{La.value&&(La.value=La.value.filter((e=>!a.includes(e.id))))},Ya=()=>{Ca.value&&Pa.value&&ua(Pa.value,Ca.value,(()=>Na(Pa.value,{getList:!1,refresh:!1})))},Ga=async()=>{10===Ca.value?.privacy&&window.$dialog.warning({title:"公开隐私歌单",content:"确认公开这个歌单？该操作无法撤销！",positiveText:"公开",negativeText:"取消",onPositiveClick:async()=>{200===(await O(Pa.value)).code&&(Ca.value&&(Ca.value.privacy=0),window.$message.success("歌单公开成功"))}})};return oa((a=>{const e=Number(a.query.id);e&&($a.value=e,Na(e))})),u((()=>{if(0===$a.value)$a.value=Pa.value;else{const a=$a.value===Pa.value;$a.value=Pa.value,Na(Pa.value,{getList:!0,refresh:a})}})),r((()=>Ja(!1))),d((()=>Ja(!1))),v((()=>Na(Pa.value))),(e,s)=>{const l=X,t=Z,i=A,o=J,n=K,c=Q,u=V,r=W,d=Y,v=G,k=M,w=aa,b=ea,_=a,L=sa;return T(),p("div",{class:f(["playlist",{small:h(ja)}])},[m(y,{name:"fade",mode:"out-in"},{default:g((()=>[h(Ca)?(T(),p("div",ra,[x("div",da,[m(l,{src:h(Ca).coverSize?.m||h(Ca).cover,"previewed-img-props":{style:{borderRadius:"8px"}},"preview-src":h(Ca).cover,renderToolbar:h($),"show-toolbar-tooltip":"",class:"cover-img",onLoad:h(P)},{placeholder:g((()=>s[2]||(s[2]=[x("div",{class:"cover-loading"},[x("img",{src:na,class:"loading-img",alt:"loading-img"})],-1)]))),_:1},8,["src","preview-src","renderToolbar","onLoad"]),m(l,{class:"cover-shadow","preview-disabled":"",src:h(Ca).coverSize?.m||h(Ca).cover},null,8,["src"]),s[3]||(s[3]=x("div",{class:"cover-mask"},null,-1)),x("div",va,[m(t,{name:"Play"}),x("span",pa,S(h(I)(h(Ca).playCount||0)),1)])]),x("div",ma,[m(n,{class:"name text-hidden"},{default:g((()=>[j(S(h(Ca).name||"未知歌单")+" ",1),10===h(Ca)?.privacy?(T(),R(o,{key:0,"show-arrow":!1,placement:"right"},{trigger:g((()=>[m(t,{depth:3,name:"EyeLock",size:"22"})])),default:g((()=>[m(i,null,{default:g((()=>s[4]||(s[4]=[j("隐私歌单")]))),_:1})])),_:1})):z("",!0)])),_:1}),m(d,{show:!h(ja),class:"collapse"},{default:g((()=>[h(Ca).description?(T(),R(c,{key:0,"line-clamp":1,tooltip:{trigger:"click",placement:"bottom",width:"trigger"}},{default:g((()=>[j(S(h(Ca).description),1)])),_:1})):z("",!0),m(r,{class:"meta"},{default:g((()=>[x("div",ga,[m(t,{name:"Person",depth:3}),m(i,null,{default:g((()=>[j(S(h(Ca).creator?.name||"未知用户名"),1)])),_:1})]),h(Ca).updateTime?(T(),p("div",ya,[m(t,{name:"Update",depth:3}),m(i,null,{default:g((()=>[j(S(h(D)(h(Ca).updateTime)),1)])),_:1})])):h(Ca).createTime?(T(),p("div",fa,[m(t,{name:"Time",depth:3}),m(i,null,{default:g((()=>[j(S(h(D)(h(Ca).createTime)),1)])),_:1})])):z("",!0),h(Ca).tags?.length?(T(),p("div",ha,[m(t,{name:"Tag",depth:3}),m(r,{class:"tags"},{default:g((()=>[(T(!0),p(q,null,U(h(Ca).tags,((a,e)=>(T(),R(u,{key:e,bordered:!1,round:"",onClick:e=>h(la).push({name:"discover-playlists",query:{cat:a}})},{default:g((()=>[j(S(a),1)])),_:2},1032,["onClick"])))),128))])),_:1})])):z("",!0)])),_:1})])),_:1},8,["show"]),m(r,{class:"menu",justify:"space-between"},{default:g((()=>[m(r,{class:"left",align:"flex-end"},{default:g((()=>[m(v,{focusable:!1,disabled:h(Sa),loading:h(Sa),type:"primary",strong:"",secondary:"",round:"",onClick:h(Ka)},{icon:g((()=>[m(t,{name:"Play"})])),default:g((()=>[j(" "+S(h(Sa)?h(Ba)?"更新中...":`加载中... (${h(La).length===h(Ca).count?0:h(La).length}/${h(Ca).count})`:"播放"),1)])),_:1},8,["disabled","loading","onClick"]),h(Da)?(T(),R(v,{key:0,focusable:!1,strong:"",secondary:"",round:"",onClick:Ya},{icon:g((()=>[m(t,{name:"EditNote"})])),default:g((()=>[s[5]||(s[5]=j(" 编辑歌单 "))])),_:1})):(T(),R(v,{key:1,focusable:!1,strong:"",secondary:"",round:"",onClick:s[0]||(s[0]=a=>h(B)(h(Pa),!h(qa)))},{icon:g((()=>[m(t,{name:h(qa)?"Favorite":"FavoriteBorder"},null,8,["name"])])),default:g((()=>[j(" "+S(h(qa)?"取消收藏":"收藏歌单"),1)])),_:1})),m(k,{options:h(Ha),trigger:"click",placement:"bottom-start"},{default:g((()=>[m(v,{focusable:!1,class:"more",circle:"",strong:"",secondary:""},{icon:g((()=>[m(t,{name:"List"})])),_:1})])),_:1},8,["options"])])),_:1}),m(r,{class:"right"},{default:g((()=>[h(La)?.length?(T(),R(w,{key:0,value:h(Ta),"onUpdate:value":s[1]||(s[1]=a=>H(Ta)?Ta.value=a:null),"input-props":{autocomplete:"off"},class:"search",placeholder:"模糊搜索",clearable:"",round:"",onInput:h(Qa)},{prefix:g((()=>[m(t,{name:"Search"})])),_:1},8,["value","onInput"])):z("",!0)])),_:1})])),_:1})])])):(T(),p("div",ka,[m(b,{class:"cover"}),x("div",wa,[m(b,{repeat:4,text:""})])]))])),_:1}),m(y,{name:"fade",mode:"out-in"},{default:g((()=>[!h(Ta)||h(xa)?.length?(T(),R(_,{key:0,data:h(Ra),loading:h(Sa),height:h(za),playListId:h(Pa),onScroll:Za,onRemoveSong:Wa},null,8,["data","loading","height","playListId"])):(T(),R(L,{key:1,description:`搜不到关于 ${h(Ta)} 的任何歌曲呀`,style:{"margin-top":"60px"},size:"large"},{icon:g((()=>[m(t,{name:"SearchOff"})])),_:1},8,["description"]))])),_:1})],2)}}}),[["__scopeId","data-v-15593eca"]]);export{ba as default};
