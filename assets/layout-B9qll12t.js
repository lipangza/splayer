import{d as a,dd as e,u as l,r as s,f as t,Z as o,dj as n,dk as u,aR as c,cX as i,w as d,o as r,co as f,bN as m,H as g,I as p,k as h,j as v,m as b,am as w,aZ as _,aj as y,ar as k,ck as P,h as S,a1 as x,bO as j,i as C,ae as F,af as $,cq as L,cp as R,bA as D,aA as z,aB as A,bJ as I,a8 as U,cf as q,aa as B,c6 as G,aq as K,cG as M,au as N,bb as Z,b1 as H,b2 as J,b3 as O,K as V}from"./stores-Jq5HPlpq.js";import{u as X,o as E,d as Q,p as T}from"./index-CrsIAaLK.js";const W={class:"local"},Y={class:"title"},aa=V(a({__name:"layout",setup(a){const V=X(),aa=e(),ea=l(),la=s(!0),sa=s(null),ta=_("local"),oa=s(V.currentRoute.value?.name||"local-songs"),na=s(""),ua=s([]),ca=s(""),ia=s(!1),da=t((()=>na.value&&ua.value.length?ua.value:aa.localSongs)),ra=t((()=>{const a=aa.localSongs.reduce(((a,e)=>a+(e?.size||0)),0);return Number((a/1024).toFixed(2))})),fa=t((()=>[{label:"本地目录管理",key:"folder",props:{onClick:()=>ia.value=!0},icon:I("FolderCog")},{label:"批量操作",key:"batch",props:{onClick:()=>Q(da.value,!0)},icon:I("Batch")}])),ma=o((async(a=!1)=>{const e=await(async()=>(ca.value=await window.electron.ipcRenderer.invoke("get-default-dir","music"),[ea.showDefaultLocalPath?ca.value:"",...ea.localFilesPath]))();if(!e||!e.length)return;a&&(sa.value=window.$message.loading("正在获取本地歌曲",{duration:0})),la.value=!0;const l=e.map((a=>window.electron.ipcRenderer.invoke("get-music-files",a))),s=(await Promise.allSettled(l)).filter((a=>"fulfilled"===a.status)).map((a=>a.value)),t=n(u(s),"id"),o=c(t),i=aa.localSongs.length;0===i&&o.length>0?window.$message.success(`发现 ${o.length} 首歌曲`):o.length>i&&window.$message.success(`新增 ${o.length-i} 首歌曲`),a&&window.$message.success(`已发现 ${o.length} 首`),aa.updateLocalSong(o),la.value=!1,sa.value?.destroy(),sa.value=null}),300,{leading:!0,trailing:!1}),ga=o((a=>{if(!(a=a.trim())||""===a)return;const e=i(a,aa.localSongs);ua.value=e}),300);return ta.on((()=>ma())),d((()=>[ea.localFilesPath,ea.showDefaultLocalPath]),(async()=>await ma()),{deep:!0}),E((a=>{"local"===a.matched[0].name&&(oa.value=a.name)})),r(ma),(a,e)=>{const l=y,s=U,t=q,o=k,n=B,u=G,c=K,i=M,d=N,r=f("RouterView"),_=Z,I=H,X=J,E=O,Q=P,sa=m("debounce");return S(),g("div",W,[p("div",Y,[h(l,{class:"keyword"},{default:v((()=>e[7]||(e[7]=[x("本地歌曲")]))),_:1}),h(o,{class:"status"},{default:v((()=>[h(l,{class:"item"},{default:v((()=>[h(s,{name:"Music",depth:3}),h(t,{from:0,to:b(aa).localSongs?.length||0},null,8,["to"]),e[8]||(e[8]=x(" 首歌曲 "))])),_:1}),h(l,{class:"item"},{default:v((()=>[h(s,{name:"Storage",depth:3}),h(t,{from:0,to:b(ra),precision:2},null,8,["to"]),e[9]||(e[9]=x(" GB "))])),_:1})])),_:1})]),h(o,{class:"menu",justify:"space-between"},{default:v((()=>[h(o,{class:"left",align:"flex-end"},{default:v((()=>[j((S(),C(n,{focusable:!1,disabled:b(la)&&!b(aa).localSongs?.length,loading:b(la),type:"primary",strong:"",secondary:"",round:""},{icon:v((()=>[h(s,{name:"Play"})])),default:v((()=>[e[10]||(e[10]=x(" 播放 "))])),_:1},8,["disabled","loading"])),[[sa,()=>b(T).updatePlayList(b(da))]]),h(n,{focusable:!1,class:"more",strong:"",secondary:"",circle:"",onClick:e[0]||(e[0]=a=>b(ma)(!0))},{icon:v((()=>[h(s,{name:"Refresh"})])),_:1}),h(u,{options:b(fa),trigger:"click",placement:"bottom-start"},{default:v((()=>[h(n,{focusable:!1,class:"more",circle:"",strong:"",secondary:""},{icon:v((()=>[h(s,{name:"List"})])),_:1})])),_:1},8,["options"])])),_:1}),h(o,{class:"right",justify:"end"},{default:v((()=>[b(aa).localSongs?.length?(S(),C(c,{key:0,value:b(na),"onUpdate:value":e[1]||(e[1]=a=>w(na)?na.value=a:null),"input-props":{autocomplete:"off"},class:"search",placeholder:"模糊搜索",clearable:"",round:"",onInput:b(ga)},{prefix:v((()=>[h(s,{name:"Search"})])),_:1},8,["value","onInput"])):F("",!0),h(d,{value:b(oa),"onUpdate:value":[e[2]||(e[2]=a=>w(oa)?oa.value=a:null),e[3]||(e[3]=a=>b(V).push({name:a}))],class:"tabs",type:"segment"},{default:v((()=>[h(i,{name:"local-songs"},{default:v((()=>e[11]||(e[11]=[x(" 单曲 ")]))),_:1}),h(i,{disabled:0===b(da).length,name:"local-artists"},{default:v((()=>e[12]||(e[12]=[x(" 歌手 ")]))),_:1},8,["disabled"]),h(i,{disabled:0===b(da).length,name:"local-albums"},{default:v((()=>e[13]||(e[13]=[x(" 专辑 ")]))),_:1},8,["disabled"])])),_:1},8,["value"])])),_:1})])),_:1}),h(r,null,{default:v((({Component:a})=>[h($,{name:`router-${b(ea).routeAnimation}`,mode:"out-in"},{default:v((()=>[b(ea).useKeepAlive?(S(),C(R,{key:0},[(S(),C(L(a),{data:b(da),loading:b(la),class:"router-view"},null,8,["data","loading"]))],1024)):(S(),C(L(a),{key:1,data:b(da),loading:b(la),class:"router-view"},null,8,["data","loading"]))])),_:2},1032,["name"])])),_:1}),h(Q,{show:b(ia),"onUpdate:show":e[6]||(e[6]=a=>w(ia)?ia.value=a:null),"close-on-esc":!1,"mask-closable":!1,preset:"card",title:"目录管理","transform-origin":"center",style:{width:"600px"}},{footer:v((()=>[h(o,{justify:"center"},{default:v((()=>[h(n,{class:"add-path",strong:"",secondary:"",onClick:e[5]||(e[5]=a=>b(D)())},{icon:v((()=>[h(s,{name:"FolderPlus"})])),default:v((()=>[e[15]||(e[15]=x(" 添加文件夹 "))])),_:1})])),_:1})])),default:v((()=>[h(E,{class:"local-list",hoverable:"",clickable:"",bordered:""},{header:v((()=>[h(l,null,{default:v((()=>e[14]||(e[14]=[x("请选择本地音乐文件夹，将自动扫描您添加的目录，歌曲增删实时同步")]))),_:1})])),default:v((()=>[b(ca)?(S(),C(X,{key:0},{prefix:v((()=>[h(s,{size:20,name:"FolderMusic"})])),suffix:v((()=>[h(_,{value:b(ea).showDefaultLocalPath,"onUpdate:value":e[4]||(e[4]=a=>b(ea).showDefaultLocalPath=a),round:!1,class:"set"},null,8,["value"])])),default:v((()=>[h(I,{title:b(ca),description:"系统默认音乐文件夹"},null,8,["title"])])),_:1})):F("",!0),(S(!0),g(z,null,A(b(ea).localFilesPath,((a,e)=>(S(),C(X,{key:e},{prefix:v((()=>[h(s,{size:20,name:"Folder"})])),suffix:v((()=>[h(n,{quaternary:"",onClick:a=>b(D)(e)},{icon:v((()=>[h(s,{size:20,name:"Delete"})])),_:2},1032,["onClick"])])),default:v((()=>[h(I,{title:a},null,8,["title"])])),_:2},1024)))),128))])),_:1})])),_:1},8,["show"])])}}}),[["__scopeId","data-v-fd5c9217"]]);export{aa as default};
