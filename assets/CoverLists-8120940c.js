import{P as e,Q as l,R as s,a7 as a,a8 as t,r as o,M as i,W as n,Y as r,a1 as c,a2 as u,U as p,ao as d,c1 as m,aW as g,ap as y,aA as h,aB as k,_ as v,S as f,am as b,j as C,N as L,Z as w,$ as _,O as $,ac as U,X as T,ah as j,T as x,A as P,h as R,bs as M,bv as V,aJ as H,bw as z}from"./index-62a86a6d.js";import{l as S}from"./album-03f4a364.js";import{f as A}from"./formRules-8f71b7bd.js";import{_ as D,a as N}from"./FormItem-9925873e.js";import{_ as W}from"./Select-874bd504.js";import{g as B,_ as F}from"./getCoverUrl-483cfc93.js";import{P as Z}from"./PlayOne-08324da2.js";import{L as I,a as Q,_ as X}from"./LinkTwo-de3400c3.js";import{U as q}from"./Unlike-8f9bbc24.js";import{a as O,_ as Y}from"./Grid-b6f95812.js";import{_ as E}from"./Skeleton-341b61e6.js";const G=e("editor",!0,(function(e){return l("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[l("path",{d:"M40 33V42C40 43.1046 39.1046 44 38 44H31.5",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),l("path",{d:"M40 16V6C40 4.89543 39.1046 4 38 4H10C8.89543 4 8 4.89543 8 6V42C8 43.1046 8.89543 44 10 44H16",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),l("path",{d:"M16 16H30",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap},null),l("path",{d:"M23 44L40 23",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap},null),l("path",{d:"M16 24H24",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap},null)])})),J=e("headset",!1,(function(e){return l("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[l("path",{d:"M42 30V24.4615C42 14.2655 33.9411 6 24 6C14.0589 6 6 14.2655 6 24.4615V30",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),l("path",{d:"M34 32C34 29.7909 35.7909 28 38 28H42V42H38C35.7909 42 34 40.2091 34 38V32Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null),l("path",{d:"M42 32H44C45.1046 32 46 32.8954 46 34V36C46 37.1046 45.1046 38 44 38H42V32Z",fill:e.colors[0]},null),l("path",{d:"M6 32H4C2.89543 32 2 32.8954 2 34V36C2 37.1046 2.89543 38 4 38H6V32Z",fill:e.colors[0]},null),l("path",{d:"M6 28H10C12.2091 28 14 29.7909 14 32V38C14 40.2091 12.2091 42 10 42H6V28Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null)])})),K={__name:"PlaylistUpdate",setup(e,{expose:v}){const{t:f}=s(),{textRule:b}=A(),C=a(),L=t(),w=o(null),_=o(null),$=o(!1),U={name:b},T=o({name:null,desc:null,tags:null}),j=e=>{var l;e.preventDefault(),null==(l=_.value)||l.validate((e=>{e?($loadingBar.error(),$message.error(f("general.message.needCheck"))):m(w.value,T._value.name,T._value.desc,T._value.tags.join(";")).then((e=>{200===e.code?($message.success(f("general.message.editorSuccess")),R(),L.setUserPlayLists()):$message.error(f("general.message.editorFailed"))}))}))},x=o([]),P=()=>{C.catList.sub?x.value=C.catList.sub.map((e=>({label:e.name,value:e.name}))):C.setCatList()},R=()=>{$.value=!1,w.value=null};return v({openUpdateModal:e=>{T.value={name:e.name,desc:e.desc,tags:e.tags},w.value=e.id,$.value=!0}}),(e,s)=>{const a=g,t=D,o=W,m=N,v=y,f=h,b=k;return i(),n(b,{class:"s-modal",show:p($),"onUpdate:show":s[3]||(s[3]=e=>d($)?$.value=e:null),preset:"card",title:e.$t("menu.update"),bordered:!1,"on-after-leave":R},{footer:r((()=>[l(f,{justify:"end"},{default:r((()=>[l(v,{onClick:R},{default:r((()=>[c(u(e.$t("general.dialog.cancel")),1)])),_:1}),l(v,{type:"primary",onClick:j},{default:r((()=>[c(u(e.$t("general.dialog.editor")),1)])),_:1})])),_:1})])),default:r((()=>[l(m,{ref_key:"playlistUpdateRef",ref:_,rules:U,"label-width":80,model:p(T)},{default:r((()=>[l(t,{label:e.$t("other.plName"),path:"name"},{default:r((()=>[l(a,{value:p(T).name,"onUpdate:value":s[0]||(s[0]=e=>p(T).name=e),placeholder:e.$t("other.plNameTip")},null,8,["value","placeholder"])])),_:1},8,["label"]),l(t,{label:e.$t("other.plDes"),path:"desc"},{default:r((()=>[l(a,{value:p(T).desc,"onUpdate:value":s[1]||(s[1]=e=>p(T).desc=e),type:"textarea",placeholder:e.$t("other.plDesTip"),autosize:{minRows:3,maxRows:5}},null,8,["value","placeholder"])])),_:1},8,["label"]),l(t,{label:e.$t("other.plTag"),path:"tags"},{default:r((()=>[l(o,{multiple:"",value:p(T).tags,"onUpdate:value":s[2]||(s[2]=e=>p(T).tags=e),placeholder:e.$t("other.plTagTip"),options:p(x),onClick:P},null,8,["value","placeholder","options"])])),_:1},8,["label"])])),_:1},8,["model"])])),_:1},8,["show","title"])}}},ee={class:"coverlists"},le={class:"cover"},se={class:"cover-loading"},ae={key:0,class:"description"},te={key:0,class:"num"},oe={class:"des"},ie={key:1,class:"num"},ne={class:"des"},re={class:"title"},ce={class:"name text-hidden"},ue={key:0,class:"by"},pe={key:1,class:"by"},de=v({__name:"CoverLists",props:{listData:{type:Array,default:[]},listType:{type:String,default:"playlist"},columns:{type:String,default:"3 s:4 m:5 l:6"},gridCollapsed:{type:Boolean,default:!1},gridCollapsedRows:{type:Number,default:2},loadingNum:{type:Number,default:30}},setup(e){const c=e,{t:d}=s(),m=f(),g=a(),y=t(),h=b(),k=o(null),v=e=>()=>R(U,{style:{transform:"translateX(2px)"}},{default:()=>e}),A=o(0),D=o(0),N=o(!1),W=o(null),de=()=>{N.value=!1},me=e=>{var l;if(e.id===(null==(l=y.getUserPlayLists)?void 0:l.own[0].id))return $message.warning(d("menu.unableToDelete")),!1;$dialog.warning({class:"s-dialog",title:d("general.dialog.delete"),content:d("menu.delQuestion",{name:e.name}),positiveText:d("general.dialog.delete"),negativeText:d("general.dialog.cancel"),onPositiveClick:()=>{V(e.id).then((e=>{200===e.code&&($message.success(d("general.message.deleteSuccess")),y.setUserPlayLists())}))}})},ge=e=>{const l=c.listType,s=y.getUserPlayLists.like,a=y.getUserAlbumLists.list;return"playlist"===l&&s.length?!s.some((l=>l.id===Number(e))):"album"!==l||!a.length||!a.some((l=>l.id===Number(e)))},ye=async e=>{const l=c.listType,s=ge(e)?1:2,a="playlist"===l?z:S,t=d("playlist"===l?"general.name.playlist":"general.name.album"),o="zh-CN"===h.language?"":" ";try{200===(await a(s,e)).code?($message.success(`${t+o}${d(1==s?"menu.collection":"menu.cancelCollection",{name:d("general.dialog.success")})}`),"playlist"===l?y.setUserPlayLists():y.setUserAlbumLists()):$message.error(`${t+o}${d(1==s?"menu.collection":"menu.cancelCollection",{name:d("general.dialog.failed")})}`)}catch(i){$message.error(`${t+o}${d(1==s?"menu.collection":"menu.cancelCollection",{name:d("general.dialog.failed")})}`),console.error(`${t+o}${d(1==s?"menu.collection":"menu.cancelCollection",{name:d("general.dialog.failed")})}`,i)}};return C((()=>{"user-playlists"!==m.currentRoute.value.name||g.catList.sub||g.setCatList(),!y.userLogin||y.getUserPlayLists.has||y.getUserPlayLists.isLoading||"playlist"!==c.listType||y.setUserPlayLists(),!y.userLogin||y.getUserAlbumLists.has||y.getUserAlbumLists.isLoading||"album"!==c.listType||y.setUserAlbumLists()})),(s,a)=>{const t=X,o=F,g=O,h=Y,f=E,b=H;return i(),L("div",ee,[l(x,{mode:"out-in"},{default:r((()=>[e.listData[0]?(i(),n(h,{key:0,"x-gap":"20","y-gap":"26",responsive:"screen",cols:e.columns,collapsed:e.gridCollapsed,"collapsed-rows":e.gridCollapsedRows},{default:r((()=>[(i(!0),L(w,null,_(e.listData,(s=>(i(),n(g,{class:"item",key:s,onClick:e=>{return l=s.id,void("playlist"===c.listType||"topList"===c.listType?m.push({path:"/playlist",query:{id:l,page:1}}):"album"===c.listType&&m.push({path:"/album",query:{id:l}}));var l},onContextmenu:e=>{return a=s,(l=e).preventDefault(),N.value=!1,void P().then((()=>{W.value=[{key:"update",label:d("menu.update"),show:"user-playlists"===m.currentRoute.value.name,props:{onClick:()=>{k.value.openUpdateModal(a)}},icon:v(R(G))},{key:"del",label:d("menu.del"),show:"user-playlists"===m.currentRoute.value.name,props:{onClick:()=>{me(a)}},icon:v(R(M))},{key:"likePlaylist",label:ge(a.id)?d("menu.collection",{name:d("general.name.playlist")}):d("menu.cancelCollection",{name:d("general.name.playlist")}),show:!(!y.userLogin||!y.getUserPlayLists.has||"playlist"!==c.listType||"user-playlists"===m.currentRoute.value.name),props:{onClick:()=>{ye(a.id)}},icon:v(R(ge(a.id)?I:q))},{key:"likeAlbum",label:ge(a.id)?d("menu.collection",{name:d("general.name.album")}):d("menu.cancelCollection",{name:d("general.name.album")}),show:!(!y.userLogin||!y.getUserAlbumLists.has||"album"!==c.listType),props:{onClick:()=>{ye(a.id)}},icon:v(R(ge(a.id)?I:q))},{key:"copy",label:d("menu.copy",{name:"playlist"===c.listType?d("general.name.playlist"):d("general.name.album"),other:d("general.name.link")}),props:{onClick:()=>{if(navigator.clipboard)try{navigator.clipboard.writeText(`https://music.163.com/#/${"playlist"===c.listType?"playlist":"album"}?id=${a.id}`),$message.success(d("general.message.copySuccess"))}catch(e){console.error(d("general.message.copyFailure"),e),$message.error(d("general.message.copyFailure"))}else $message.error(d("general.message.notSupported"))}},icon:v(R(Q))}],N.value=!0,A.value=l.clientX,D.value=l.clientY}));var l,a}},{default:r((()=>[$("div",le,[l(o,{lazy:"",class:"coverImg","preview-disabled":"",src:p(B)(s.cover,300),"fallback-src":"/images/pic/default.png"},{placeholder:r((()=>[$("div",se,[l(t,{size:"small"})])])),_:2},1032,["src"]),l(o,{lazy:"",class:"shadow","preview-disabled":"",src:p(B)(s.cover,300),"fallback-src":"/images/pic/default.png"},null,8,["src"]),l(p(U),{class:"play",size:"40"},{default:r((()=>[l(p(Z),{theme:"filled"})])),_:1}),"topList"!=e.listType?(i(),L("div",ae,["playlist"==e.listType?(i(),L("div",te,[l(p(U),null,{default:r((()=>[l(p(J),{theme:"filled"})])),_:1}),$("span",oe,u(s.playCount),1)])):(i(),L("div",ie,[$("span",ne,u(s.time),1)]))])):T("",!0)]),$("div",re,[$("span",ce,u(s.name),1),"playlist"==e.listType&&s.artist?(i(),L("span",ue," By "+u(s.artist.nickname),1)):"topList"==e.listType&&s.update?(i(),L("span",pe,u(s.update),1)):(i(),n(j,{key:2,class:"text-hidden",artistsData:s.artist},null,8,["artistsData"]))])])),_:2},1032,["onClick","onContextmenu"])))),128))])),_:1},8,["cols","collapsed","collapsed-rows"])):(i(),n(h,{key:1,class:"loading","x-gap":"20","y-gap":"26",cols:e.columns,responsive:"screen",collapsed:e.gridCollapsed,"collapsed-rows":e.gridCollapsedRows},{default:r((()=>[(i(!0),L(w,null,_(e.loadingNum,(e=>(i(),n(g,{class:"item",key:e},{default:r((()=>[l(f,{class:"pic",sharp:!1}),l(f,{text:"",repeat:1}),l(f,{text:"",style:{width:"60%"}})])),_:2},1024)))),128))])),_:1},8,["cols","collapsed","collapsed-rows"]))])),_:1}),l(b,{style:{"--n-font-size":"14px","--n-border-radius":"6px"},placement:"bottom-start",trigger:"manual",size:"large",x:p(A),y:p(D),options:p(W),show:p(N),"on-clickoutside":de,onSelect:a[0]||(a[0]=e=>N.value=!1)},null,8,["x","y","options","show"]),l(K,{ref_key:"playlistUpdateRef",ref:k},null,512)])}}},[["__scopeId","data-v-a0fac1e4"]]);export{de as C};
