import{_ as a}from"./SongList-DlSTL_cD.js";import{d as e,as as s,b as l,r as t,L as i,f as o,Z as n,cX as c,S as u,R as d,Q as r,o as v,H as p,k as m,j as g,af as f,ac as h,m as y,cY as k,cz as b,X as _,b8 as L,aR as w,aT as S,cZ as T,h as C,I as x,cP as I,ad as j,a2 as P,cU as R,a1 as $,i as z,ae as U,cV as H,aA as q,aB as B,am as X,bJ as Z,ai as A,a8 as D,cW as E,cm as J,aj as K,aI as N,ar as O,b9 as Q,aa as V,c6 as W,aq as Y,ak as F,b4 as G,K as M}from"./stores-De5JHsxi.js";import{u as aa,p as ea,b as sa,e as la,d as ta}from"./index-tqBPJ7OH.js";const ia={key:0,class:"detail"},oa={class:"cover"},na={class:"play-count"},ca={class:"num"},ua={class:"data"},da={class:"item"},ra={key:0,class:"item"},va={key:1,class:"item"},pa={key:2,class:"item"},ma={key:1,class:"detail"},ga={class:"data"},fa=M(e({__name:"liked",setup(e){const M=aa(),fa=s(),ha=l(),ya=t(!1),ka=i([]),ba=t(null),_a=t(""),La=t([]),wa=o((()=>fa.userLikeData.playlists?.[0]?.id)),Sa=t(!0),Ta=t(null),Ca=t(!1),xa=o((()=>_a.value?La.value:ka.value)),Ia=o((()=>ha.mainContentHeight-(Ca.value?120:240))),ja=o((()=>"like-songs"===M.currentRoute.value.name)),Pa=o((()=>[{label:"编辑歌单",key:"edit",props:{onClick:()=>{ba.value&&wa.value&&la(wa.value,ba.value,(()=>Ra(wa.value,{getList:!1,refresh:!1})))}},icon:Z("EditNote")},{label:"批量操作",key:"batch",props:{onClick:()=>ta(xa.value,!1,wa.value)},icon:Z("Batch")},{label:"打开源页面",key:"open",props:{onClick:()=>{window.open(`https://music.163.com/#/playlist?id=${wa.value}`)}},icon:Z("Link")}])),Ra=async(a,e={getList:!0,refresh:!1})=>{if(!a)return;Sa.value=!0;const{getList:s,refresh:l}=e;Ba(),l||$a(s),za(a,s,l)},$a=a=>{ba.value=null,a&&(ka.value=[],Ca.value=!1)},za=async(a,e,s)=>{Ua();const l=await k(a);if(ba.value=b(l.playlist)[0],e&&0!==ba.value.count){if(1===_()&&ba.value?.count<800){const a=l.privileges.map((a=>a.id)),e=await L(a);ka.value=w(e.songs)}else await Ha(a,ba.value.count||0,s);fa.setLikeSongsList(ba.value,ka.value),Sa.value=!1}else Sa.value=!1},Ua=()=>{S(fa.likeSongsList.detail)&&(ba.value=fa.likeSongsList.detail),fa.likeSongsList.data.length&&(ka.value=fa.likeSongsList.data)},Ha=async(a,e,s=!1)=>{Sa.value=!0,Aa(!s);let l=0;const t=[];do{const e=await T(a,500,l),i=w(e.songs);t.push(...i),s||(ka.value=ka.value.concat(i)),l+=500}while(l<e&&ja.value);s&&(ka.value=t),Aa(!1)},qa=a=>{const e=a.target.scrollTop;Ca.value=e>10},Ba=()=>{_a.value="",La.value=[]},Xa=n((()=>{ba.value&&ka.value?.length&&ea.updatePlayList(ka.value,void 0,wa.value)}),300),Za=n((a=>{if(!(a=a.trim())||""===a)return;const e=c(a,ka.value);La.value=e}),300),Aa=(a=!0)=>{a?(Ta.value?.destroy(),Ta.value=window.$message.loading("该歌单歌曲数量过多，请稍等",{duration:0,closable:!0})):(Sa.value=!1,Ta.value?.destroy(),Ta.value=null)},Da=a=>{ka.value&&(ka.value=ka.value.filter((e=>!a.includes(e.id))))};return u((()=>{ya.value?Ra(wa.value,{getList:!0,refresh:!0}):ya.value=!0})),d((()=>Aa(!1))),r((()=>Aa(!1))),v((async()=>{const a=await fa.getUserLikePlaylist(),e=a?.detail?.id;e&&Ra(e)})),(e,s)=>{const l=A,t=D,i=E,o=J,n=K,c=N,u=O,d=Q,r=V,v=W,k=Y,b=F,_=a,L=G;return C(),p("div",{class:h(["liked",{small:y(Ca)}])},[m(f,{name:"fade",mode:"out-in"},{default:g((()=>[y(ba)?(C(),p("div",ia,[x("div",oa,[m(l,{src:y(ba).coverSize?.m||y(ba).cover,"previewed-img-props":{style:{borderRadius:"8px"}},"preview-src":y(ba).cover,renderToolbar:y(I),"show-toolbar-tooltip":"",class:"cover-img",onLoad:y(j)},{placeholder:g((()=>s[1]||(s[1]=[x("div",{class:"cover-loading"},[x("img",{src:sa,class:"loading-img",alt:"loading-img"})],-1)]))),_:1},8,["src","preview-src","renderToolbar","onLoad"]),m(l,{class:"cover-shadow","preview-disabled":"",src:y(ba).coverSize?.m||y(ba).cover},null,8,["src"]),s[2]||(s[2]=x("div",{class:"cover-mask"},null,-1)),x("div",na,[m(t,{name:"Play"}),x("span",ca,P(y(R)(y(ba).playCount||0)),1)])]),x("div",ua,[m(i,{class:"name text-hidden"},{default:g((()=>s[3]||(s[3]=[$(" 我喜欢的音乐 ")]))),_:1}),m(d,{show:!y(Ca),class:"collapse"},{default:g((()=>[y(ba).description?(C(),z(o,{key:0,"line-clamp":1,tooltip:{trigger:"click",placement:"bottom",width:"trigger"}},{default:g((()=>[$(P(y(ba).description),1)])),_:1})):U("",!0),m(u,{class:"meta"},{default:g((()=>[x("div",da,[m(t,{name:"Person",depth:3}),m(n,null,{default:g((()=>[$(P(y(ba).creator?.name||"未知用户名"),1)])),_:1})]),y(ba).updateTime?(C(),p("div",ra,[m(t,{name:"Update",depth:3}),m(n,null,{default:g((()=>[$(P(y(H)(y(ba).updateTime)),1)])),_:1})])):y(ba).createTime?(C(),p("div",va,[m(t,{name:"Time",depth:3}),m(n,null,{default:g((()=>[$(P(y(H)(y(ba).createTime)),1)])),_:1})])):U("",!0),y(ba).tags?.length?(C(),p("div",pa,[m(t,{name:"Tag",depth:3}),m(u,{class:"tags"},{default:g((()=>[(C(!0),p(q,null,B(y(ba).tags,((a,e)=>(C(),z(c,{key:e,bordered:!1,round:"",onClick:e=>y(M).push({name:"discover-playlists",query:{cat:a}})},{default:g((()=>[$(P(a),1)])),_:2},1032,["onClick"])))),128))])),_:1})])):U("",!0)])),_:1})])),_:1},8,["show"]),m(u,{class:"menu",justify:"space-between"},{default:g((()=>[m(u,{class:"left",align:"flex-end"},{default:g((()=>[m(r,{focusable:!1,disabled:y(Sa),loading:y(Sa),type:"primary",strong:"",secondary:"",round:"",onClick:y(Xa)},{icon:g((()=>[m(t,{name:"Play"})])),default:g((()=>[$(" "+P(y(Sa)?`正在更新... (${y(ka).length===y(ba).count?0:y(ka).length}/${y(ba).count})`:"播放"),1)])),_:1},8,["disabled","loading","onClick"]),m(v,{options:y(Pa),trigger:"click",placement:"bottom-start"},{default:g((()=>[m(r,{focusable:!1,class:"more",circle:"",strong:"",secondary:""},{icon:g((()=>[m(t,{name:"List"})])),_:1})])),_:1},8,["options"])])),_:1}),m(u,{class:"right"},{default:g((()=>[y(ka)?.length?(C(),z(k,{key:0,value:y(_a),"onUpdate:value":s[0]||(s[0]=a=>X(_a)?_a.value=a:null),"input-props":{autocomplete:"off"},class:"search",placeholder:"模糊搜索",clearable:"",round:"",onInput:y(Za)},{prefix:g((()=>[m(t,{name:"Search"})])),_:1},8,["value","onInput"])):U("",!0)])),_:1})])),_:1})])])):(C(),p("div",ma,[m(b,{class:"cover"}),x("div",ga,[m(b,{repeat:4,text:""})])]))])),_:1}),m(f,{name:"fade",mode:"out-in"},{default:g((()=>[!y(_a)||y(La)?.length?(C(),z(_,{key:0,data:y(xa),loading:y(Sa),height:y(Ia),playListId:y(wa),onScroll:qa,onRemoveSong:Da},null,8,["data","loading","height","playListId"])):(C(),z(L,{key:1,description:`搜不到关于 ${y(_a)} 的任何歌曲呀`,style:{"margin-top":"60px"},size:"large"},{icon:g((()=>[m(t,{name:"SearchOff"})])),_:1},8,["description"]))])),_:1})],2)}}}),[["__scopeId","data-v-4be844b1"]]);export{fa as default};
