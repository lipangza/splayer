import{_ as a}from"./SongList-DlSTL_cD.js";import{d as e,as as l,b as s,L as t,r as o,f as i,Z as n,cX as r,S as d,R as u,Q as c,o as v,H as m,k as p,j as f,af as g,ac as h,m as y,d1 as _,cz as b,d2 as k,aR as w,h as T,I as j,cP as x,ad as L,a1 as I,a2 as S,i as C,ae as R,cV as $,aA as z,aB as P,d3 as q,am as H,bJ as B,ai as F,cW as N,cm as U,a8 as A,aj as D,aI as J,ar as K,b9 as M,aa as O,c6 as Q,aq as V,ak as W,b4 as X,K as Z}from"./stores-De5JHsxi.js";import{u as E,p as G,o as Y,b as aa}from"./index-tqBPJ7OH.js";const ea={key:0,class:"detail"},la={class:"cover"},sa={class:"data"},ta={class:"item"},oa={class:"item"},ia={key:0,class:"item"},na={key:1,class:"item"},ra={key:2,class:"item"},da={key:1,class:"detail"},ua={class:"data"},ca=Z(e({__name:"radio",setup(e){const Z=E(),ca=l(),va=s(),ma=t([]),pa=o(null),fa=o(""),ga=o([]),ha=o(0),ya=i((()=>Number(Z.currentRoute.value.query.id))),_a=o(!0),ba=o(null),ka=o(!1),wa=i((()=>fa.value?ga.value:ma.value)),Ta=i((()=>va.mainContentHeight-(ka.value?120:240))),ja=i((()=>ca.userLikeData.djs.some((a=>a.id===pa.value?.id)))),xa=i((()=>"radio"===Z.currentRoute.value.name)),La=i((()=>ha.value===ya.value)),Ia=i((()=>[{label:"刷新播客",key:"refresh",props:{onClick:()=>Sa(ya.value)},icon:B("Refresh")},{label:"打开源页面",key:"open",props:{onClick:()=>{window.open(`https://music.163.com/#/djradio?id=${ya.value}`)}},icon:B("Link")}])),Sa=async a=>{if(!a)return;_a.value=!0,$a(),pa.value=null;const e=await _(a);pa.value=b(e.data)[0],await Ca(a,pa.value?.count)},Ca=async(a,e)=>{if(!a||!e)return;_a.value=!0,ma.value=[],e>500&&za();let l=0;do{const e=await k(a,500,l),s=w(e.programs);ma.value=ma.value.concat(s),l+=500}while(l<e&&xa.value);za(!1)},Ra=a=>{const e=a.target.scrollTop;ka.value=e>10},$a=()=>{fa.value="",ga.value=[]},za=(a=!0)=>{a?(ba.value?.destroy(),ba.value=window.$message.loading("该播客节目数量过多，请稍等",{duration:0,closable:!0})):(_a.value=!1,ba.value?.destroy(),ba.value=null)},Pa=n((()=>{pa.value&&ma.value?.length&&G.updatePlayList(ma.value,void 0,ya.value)}),300),qa=n((a=>{if(!(a=a.trim())||""===a)return;const e=r(a,ma.value);ga.value=e}),300);return Y((a=>{const e=Number(a.query.id);e&&(ha.value=e,Sa(e))})),d((()=>{if(0===ha.value)ha.value=ya.value;else{const a=ha.value===ya.value;ha.value=ya.value,a||Sa(ya.value)}})),u((()=>za(!1))),c((()=>za(!1))),v((()=>Sa(ya.value))),(e,l)=>{const s=F,t=N,o=U,i=A,n=D,r=J,d=K,u=M,c=O,v=Q,_=V,b=W,k=a,w=X;return T(),m("div",{class:h(["playlist",{small:y(ka)}])},[p(g,{name:"fade",mode:"out-in"},{default:f((()=>[y(pa)?(T(),m("div",ea,[j("div",la,[p(s,{src:y(pa).coverSize?.m||y(pa).cover,"previewed-img-props":{style:{borderRadius:"8px"}},"preview-src":y(pa).cover,renderToolbar:y(x),"show-toolbar-tooltip":"",class:"cover-img",onLoad:y(L)},{placeholder:f((()=>l[2]||(l[2]=[j("div",{class:"cover-loading"},[j("img",{src:aa,class:"loading-img",alt:"loading-img"})],-1)]))),_:1},8,["src","preview-src","renderToolbar","onLoad"]),p(s,{class:"cover-shadow","preview-disabled":"",src:y(pa).coverSize?.m||y(pa).cover},null,8,["src"])]),j("div",sa,[p(t,{class:"name text-hidden"},{default:f((()=>[I(S(y(pa).name||"未知播客"),1)])),_:1}),p(u,{show:!y(ka),class:"collapse"},{default:f((()=>[y(pa).description?(T(),C(o,{key:0,"line-clamp":1,tooltip:{trigger:"click",placement:"bottom",width:"trigger"}},{default:f((()=>[I(S(y(pa).description),1)])),_:1})):R("",!0),p(d,{class:"meta"},{default:f((()=>[j("div",ta,[p(i,{name:"Person",depth:3}),p(n,null,{default:f((()=>[I(S(y(pa).creator?.name||"未知用户名"),1)])),_:1})]),j("div",oa,[p(i,{name:"Music",depth:3}),p(n,null,{default:f((()=>[I(S(y(pa).count||0),1)])),_:1})]),y(pa).updateTime?(T(),m("div",ia,[p(i,{name:"Update",depth:3}),p(n,null,{default:f((()=>[I(S(y(pa).updateTime),1)])),_:1})])):y(pa).createTime?(T(),m("div",na,[p(i,{name:"Time",depth:3}),p(n,null,{default:f((()=>[I(S(y($)(y(pa).createTime)),1)])),_:1})])):R("",!0),y(pa).tags?.length?(T(),m("div",ra,[p(i,{name:"Tag",depth:3}),p(d,{class:"tags"},{default:f((()=>[(T(!0),m(z,null,P(y(pa).tags,((a,e)=>(T(),C(r,{key:e,bordered:!1,round:""},{default:f((()=>[I(S(a),1)])),_:2},1024)))),128))])),_:1})])):R("",!0)])),_:1})])),_:1},8,["show"]),p(d,{class:"menu",justify:"space-between"},{default:f((()=>[p(d,{class:"left",align:"flex-end"},{default:f((()=>[p(c,{focusable:!1,disabled:y(_a),loading:y(_a),type:"primary",strong:"",secondary:"",round:"",onClick:y(Pa)},{icon:f((()=>[p(i,{name:"Play"})])),default:f((()=>[I(" "+S(y(_a)?y(La)?"更新中...":`加载中... (${y(ma).length===y(pa).count?0:y(ma).length}/${y(pa).count})`:"播放"),1)])),_:1},8,["disabled","loading","onClick"]),p(c,{focusable:!1,strong:"",secondary:"",round:"",onClick:l[0]||(l[0]=a=>y(q)(y(ya),!y(ja)))},{icon:f((()=>[p(i,{name:y(ja)?"Favorite":"FavoriteBorder"},null,8,["name"])])),default:f((()=>[I(" "+S(y(ja)?"取消订阅":"订阅播客"),1)])),_:1}),p(v,{options:y(Ia),trigger:"click",placement:"bottom-start"},{default:f((()=>[p(c,{focusable:!1,class:"more",circle:"",strong:"",secondary:""},{icon:f((()=>[p(i,{name:"List"})])),_:1})])),_:1},8,["options"])])),_:1}),p(d,{class:"right"},{default:f((()=>[y(ma)?.length?(T(),C(_,{key:0,value:y(fa),"onUpdate:value":l[1]||(l[1]=a=>H(fa)?fa.value=a:null),"input-props":{autocomplete:"off"},class:"search",placeholder:"模糊搜索",clearable:"",round:"",onInput:y(qa)},{prefix:f((()=>[p(i,{name:"Search"})])),_:1},8,["value","onInput"])):R("",!0)])),_:1})])),_:1})])])):(T(),m("div",da,[p(b,{class:"cover"}),j("div",ua,[p(b,{repeat:4,text:""})])]))])),_:1}),p(g,{name:"fade",mode:"out-in"},{default:f((()=>[!y(fa)||y(ga)?.length?(T(),C(k,{key:0,data:y(wa),loading:y(_a),height:y(Ta),radioId:y(ya),type:"radio",onScroll:Ra},null,8,["data","loading","height","radioId"])):(T(),C(w,{key:1,description:`搜不到关于 ${y(fa)} 的任何歌曲呀`,style:{"margin-top":"60px"},size:"large"},{icon:f((()=>[p(i,{name:"SearchOff"})])),_:1},8,["description"]))])),_:1})],2)}}}),[["__scopeId","data-v-9bfd8ff9"]]);export{ca as default};
