import{d as e,as as t,aO as i,b as a,da as l,H as o,j as s,J as r,af as n,i as d,n as c,bC as u,k as f,ai as y,m as p,a7 as m,a8 as v,a5 as h,cl as g,aI as k,aA as b,aB as S,aS as z,bO as w,cV as _,cU as C,db as x,ac as B,W as T,K as A,y as E,r as R,o as O,G as $,M as L,at as I,L as M,w as D,dc as F,c5 as V,X as H,Q as j,bI as P,aY as N,b6 as q,an as U,bi as K,f as G,bh as Z,c4 as Y,dd as Q,de as X,T as J,aQ as W,ae as ee,I as te,ar as ie,df as ae,aw as le,bY as oe,dg as se,dh as re,aj as ne,b4 as de}from"./stores-fvLrIm8G.js";import{u as ce,p as ue,h as fe,c as ye,i as pe,j as me,k as ve,l as he,m as ge,n as ke,q as be,r as Se}from"./index-CugtlCeX.js";const ze={class:"song-card"},we={class:"title"},_e={class:"info"},Ce={class:"name"},xe={key:0,class:"artists text-hidden"},Be={key:1,class:"artists"},Te={key:0,class:"album text-hidden"},Ae=A(e({__name:"SongCard",props:{song:{},index:{},hiddenCover:{type:Boolean},hiddenAlbum:{type:Boolean},hiddenSize:{type:Boolean}},setup(e){const A=e,E=ce(),R=t(),O=i(),$=a(),L=l(A,"song"),I=async e=>{if(!T||!e||!L.value.path)return;if(L.value.cover||"/images/song.jpg?assest"===L.value.cover)return;const t=await window.electron.ipcRenderer.invoke("get-music-cover",L.value.path);if(!t)return;const{data:i,format:a}=t,l=pe.createBlobURL(i,a,L.value.path);l&&(L.value.cover=l)};return(e,t)=>{const i=y,a=h,l=fe,T=g,A=k;return s(),o("div",ze,[r("div",{class:B(["song-content",{play:f(O).playSong.id===f(L).id}])},[r("div",{class:"num",onDblclick:t[2]||(t[2]=u(()=>{},["stop"]))},[f(O).playSong.id!==f(L).id?(s(),d(i,{key:0,depth:"3"},{default:p(()=>[m(v(e.index+1),1)]),_:1})):(s(),d(a,{key:1,size:22,name:"Music"})),c(a,{size:28,name:f($).playStatus?"Pause":"Play",class:"status",onClick:t[0]||(t[0]=e=>f(ue).playOrPause())},null,8,["name"]),c(a,{size:28,name:"Play",class:"play",onClick:t[1]||(t[1]=e=>f(ue).addNextSong(f(L),!0))})],32),r("div",we,[e.hiddenCover?n("",!0):(s(),d(l,{key:f(L).cover,src:f(L).path?f(L).cover:f(L).coverSize?.s||f(L).cover,class:"cover","onUpdate:show":I},null,8,["src"])),r("div",_e,[r("div",Ce,[c(T,{"line-clamp":1,tooltip:{placement:"top",width:"trigger"},class:"name-text"},{default:p(()=>[m(v(f(L)?.name||"未知曲目"),1)]),_:1}),f(L)?.path&&f(L)?.quality?(s(),d(A,{key:0,bordered:!1,type:"Hi-Res"===f(L).quality?"warning":"info",class:"quality",round:""},{default:p(()=>[m(v(f(L).quality),1)]),_:1},8,["type"])):n("",!0),1===f(L).originCoverType?(s(),d(A,{key:1,bordered:!1,type:"primary",round:""},{default:p(()=>t[11]||(t[11]=[m(" 原 ")])),_:1,__:[11]})):n("",!0),1===f(L).free?(s(),d(A,{key:2,bordered:!1,type:"error",round:""},{default:p(()=>t[12]||(t[12]=[m(" VIP ")])),_:1,__:[12]})):n("",!0),4===f(L).free?(s(),d(A,{key:3,bordered:!1,type:"error",round:""},{default:p(()=>t[13]||(t[13]=[m(" EP ")])),_:1,__:[13]})):n("",!0),f(L)?.pc?(s(),d(A,{key:4,bordered:!1,class:"cloud",type:"info",round:""},{icon:p(()=>[c(a,{name:"Cloud"})]),_:1})):n("",!0),f(L)?.mv?(s(),d(A,{key:5,bordered:!1,class:"mv",type:"warning",round:"",onClick:t[3]||(t[3]=u(e=>f(E).push({name:"video",query:{id:f(L).mv}}),["stop"]))},{default:p(()=>t[14]||(t[14]=[m(" MV ")])),_:1,__:[14]})):n("",!0)]),Array.isArray(f(L).artists)?(s(),o("div",xe,[(s(!0),o(b,null,S(f(L).artists,e=>(s(),d(i,{key:e.id,class:"ar",onClick:t[4]||(t[4]=e=>f(ye)(f(L).artists))},{default:p(()=>[m(v(e.name),1)]),_:2},1024))),128))])):"radio"===f(L).type?(s(),o("div",Be,[c(i,{class:"ar"},{default:p(()=>t[15]||(t[15]=[m(" 电台节目 ")])),_:1,__:[15]})])):(s(),o("div",{key:2,class:"artists text-hidden",onClick:t[5]||(t[5]=e=>f(ye)(f(L).artists))},[c(i,{class:"ar"},{default:p(()=>[m(v(f(L).artists||"未知艺术家"),1)]),_:1})])),f(L).alia?(s(),d(i,{key:3,class:"alia text-hidden",depth:"3"},{default:p(()=>[m(v(f(L).alia),1)]),_:1})):n("",!0)])]),"radio"===f(L).type||e.hiddenAlbum?n("",!0):(s(),o("div",Te,[f(z)(f(L).album)?(s(),d(i,{key:0,class:"album-text",onClick:t[6]||(t[6]=e=>f(E).push({name:"album",query:{id:f(L).album?.id}}))},{default:p(()=>[m(v(f(L).album?.name||"未知专辑"),1)]),_:1})):(s(),d(i,{key:1,class:"album-text"},{default:p(()=>[m(v(f(L).album||"未知专辑"),1)]),_:1}))])),"radio"!==f(L).type?(s(),o("div",{key:1,class:"actions",onClick:t[9]||(t[9]=u(()=>{},["stop"])),onDblclick:t[10]||(t[10]=u(()=>{},["stop"]))},[c(a,{name:f(R).isLikeSong(f(L).id)?"Favorite":"FavoriteBorder",size:20,onClick:t[7]||(t[7]=u(e=>f(w)(f(L),!f(R).isLikeSong(f(L).id)),["stop"])),onDelclick:t[8]||(t[8]=u(()=>{},["stop"]))},null,8,["name"])],32)):n("",!0),"radio"===f(L).type?(s(),d(i,{key:2,class:"meta date",depth:"3"},{default:p(()=>[m(v(f(_)(f(L).updateTime)),1)]),_:1})):n("",!0),"radio"===f(L).type?(s(),d(i,{key:3,class:"meta",depth:"3"},{default:p(()=>[m(v(f(C)(f(L).playCount||0)),1)]),_:1})):n("",!0),c(i,{class:"meta",depth:"3"},{default:p(()=>[m(v(f(x)(f(L).duration)),1)]),_:1}),f(L).path&&f(L).size&&!e.hiddenSize?(s(),d(i,{key:4,class:"meta size",depth:"3"},{default:p(()=>[m(v(f(L).size)+"M ",1)]),_:1})):n("",!0)],2)])}}}),[["__scopeId","data-v-76aa2f7b"]]);const Ee=function(e,t,i){const{attrs:a,on:l,...o}=t;let s={};return l&&Object.entries(l).forEach(e=>{const[t,i]=e;s[`on${t[0].toUpperCase()+t.slice(1)}`]=i}),E(e,{...a,...s,...o},i)};const Re=function(e,t,i){const{attrs:a,on:l,...o}=t;let s={};return l&&Object.entries(l).forEach(e=>{const[t,i]=e;s[`on${t[0].toUpperCase()+t.slice(1)}`]=i}),E(e,{...a,...s,...o},{default:()=>i})};const Oe=function(e,t){var i;return null==(i=e.$slots)?void 0:i[t]};function $e(...e){let t="";return e.forEach(e=>{"string"==typeof e?t+=e+";":Array.isArray(e)?t+=$e(...e):"object"==typeof e&&Object.entries(e).forEach(([e,i])=>{i&&(t+=`${e}:${i};`)})}),t}const Le=e({name:"ObserverItem",props:{resizeObserver:{type:ResizeObserver,require:!0},id:{type:[String,Number],require:!0}},setup:e=>(e=>{const t=R(null);return O(()=>{e.resizeObserver&&t.value&&e.resizeObserver.observe(t.value)}),$(()=>{e.resizeObserver&&t.value&&e.resizeObserver.unobserve(t.value)}),{itemRefEl:t}})(e),render(){var e;const{id:t}=this;return Ee("div",{ref:"itemRefEl",attrs:{"data-id":t}},[null==(e=Oe(this,"default"))?void 0:e()])}}),Ie={itemGap:0,fixed:!1,buffer:0,bufferTop:0,bufferBottom:0,scrollDistance:0,horizontal:!1,fixSelection:!1,start:0,offset:0,listStyle:"",listClass:"",itemStyle:"",itemClass:"",headerClass:"",headerStyle:"",footerClass:"",footerStyle:"",stickyHeaderClass:"",stickyHeaderStyle:"",stickyFooterClass:"",stickyFooterStyle:""};function Me(e,t){const i=new Proxy(e,{get(e,t){var i;return null!=(i=Reflect.get(e,t))?i:Reflect.get(Ie,t)}}),a=R(null),l=R(null),o=R(null),s=R(null),r=R(null),n=R(null),d=new Map,c=R(0);let u="backward",f=!1,y=!1,p=!1,m=null;const v=L({clientSize:0,headerSize:0,footerSize:0,stickyHeaderSize:0,stickyFooterSize:0}),h=L({views:0,offset:0,listTotalSize:0,virtualSize:0,inViewBegin:0,inViewEnd:0,renderBegin:0,renderEnd:0,bufferTop:0,bufferBottom:0});function g(){const e=i.horizontal?"scrollLeft":"scrollTop";return a.value?a.value[e]:0}function k(){return h.listTotalSize+v.headerSize+v.footerSize+v.stickyHeaderSize+v.stickyFooterSize}function b(e){var t;return i.fixed?i.minSize+i.itemGap:null!=(t=d.get(String(e)))?t:i.minSize+i.itemGap}function S(e,t){d.set(String(e),t)}function z(e){var t,a;if(i.fixed)return{top:(i.minSize+i.itemGap)*e,current:i.minSize+i.itemGap,bottom:(i.minSize+i.itemGap)*(e+1)};const{itemKey:l}=i;let o=v.headerSize;for(let r=0;r<=e-1;r+=1){o+=b(null==(t=i.list[r])?void 0:t[l])}const s=b(null==(a=i.list[e])?void 0:a[l]);return{top:o,current:s,bottom:o+s}}function w(e){p=!0;const t=i.horizontal?"scrollLeft":"scrollTop";a.value&&(a.value[t]=e)}async function _(e){if(e<0)return;if(e>=i.list.length-1)return void C();let{top:t}=z(e);w(t);const a=()=>{const{top:i}=z(e);if(w(i),t!==i)return t=i,void(m=a);m=null};m=a}async function C(){let e=0;!function t(){e+=1,w(k()),setTimeout(()=>{e>10||Math.abs(Math.round(h.offset+v.clientSize)-Math.round(k()))>2&&t()},3)}()}function x(e){var a;e<h.inViewBegin&&(f=!0),h.inViewBegin=e,h.inViewEnd=Math.min(e+h.views,i.list.length-1),null==(a=null==t?void 0:t.rangeUpdate)||a.call(t,h.inViewBegin,h.inViewEnd)}function B(){var e,t;const{views:a,offset:l,inViewBegin:o}=h,{itemKey:s}=i,r=l-v.headerSize;let n=o,d=h.virtualSize+P(h.renderBegin,h.inViewBegin);if(r<0)x(0);else{if("forward"===u){if(r>=d)return;for(let t=n-1;t>=0;t-=1){const a=b(null==(e=i.list[t])?void 0:e[s]);if(d-=a,d<=r&&r<d+a){n=t;break}}}if("backward"===u){if(r<=d)return;for(let e=n;e<=i.list.length-1;e+=1){const a=b(null==(t=i.list[e])?void 0:t[s]);if(d<=r&&r<d+a){n=e;break}d+=a}f=!1}n!==h.inViewBegin&&x(n)}}function T(e){var a;null==(a=null==t?void 0:t.scroll)||a.call(t,e);const l=g();l!==h.offset&&(u=l<h.offset?"forward":"backward",h.offset=l,B(),function(){var e,a;const l=Math.max(i.scrollDistance,2);if("forward"===u)h.offset-l<=0&&(null==(e=null==t?void 0:t.toTop)||e.call(t,i.list[0]));else if("backward"===u){const e=Math.round(h.offset+v.clientSize);Math.round(k()-e)<=l&&(null==(a=null==t?void 0:t.toBottom)||a.call(t,i.list[i.list.length-1]))}}())}function A(){!function(){const e=Math.ceil(v.clientSize/(i.minSize+i.itemGap))+1;h.views=e}(),x(h.inViewBegin)}function E(){var e;if(i.fixed)return void(h.listTotalSize=(i.minSize+i.itemGap)*i.list.length);const{itemKey:t}=i;let a=0;for(let l=0;l<=i.list.length-1;l+=1)a+=b(null==(e=i.list[l])?void 0:e[t]);h.listTotalSize=a}function F(){h.offset=0,h.listTotalSize=0,h.virtualSize=0,h.inViewBegin=0,h.inViewEnd=0,h.renderBegin=0,h.renderEnd=0,d.clear(),V()}function V(){c.value+=1}let H;"undefined"!=typeof ResizeObserver&&(H=new ResizeObserver(e=>{var a;let l=0;for(const o of e){const e=o.target.dataset.id;if(e){const s=b(e);let r=0;if(o.borderBoxSize){const e=Array.isArray(o.borderBoxSize)?o.borderBoxSize[0]:o.borderBoxSize;r=i.horizontal?e.inlineSize:e.blockSize}else r=i.horizontal?o.contentRect.width:o.contentRect.height;"client"===e?(v.clientSize=r,A()):"header"===e?v.headerSize=r:"footer"===e?v.footerSize=r:"stickyHeader"===e?v.stickyHeaderSize=r:"stickyFooter"===e?v.stickyFooterSize=r:s!==r&&(S(e,r),l+=r-s,null==(a=null==t?void 0:t.itemResize)||a.call(t,e,r))}}h.listTotalSize+=l,m&&m(),!f&&!y||0===l||p||(f=!1,y=!1,w(h.offset+l)),p=!1}));const j=()=>{var e;let t=0;const a=h.renderBegin;for(let l=0;l<a;l++)t+=b(null==(e=i.list[l])?void 0:e[i.itemKey]);h.virtualSize=t};function P(e,t){var a;const l=Math.min(e,t),o=Math.max(e,t);let s=0;for(let r=l;r<o;r+=1)s+=b(null==(a=i.list[r])?void 0:a[i.itemKey]);return s}I(()=>{i.bufferTop?h.bufferTop=i.bufferTop:h.bufferTop=i.buffer,i.bufferBottom?h.bufferBottom=i.bufferBottom:h.bufferBottom=i.buffer}),O(()=>{a.value&&(a.value.addEventListener("scroll",T),null==H||H.observe(a.value)),r.value&&(null==H||H.observe(r.value)),n.value&&(null==H||H.observe(n.value)),o.value&&(null==H||H.observe(o.value)),s.value&&(null==H||H.observe(s.value)),i.start?_(i.start):i.offset&&w(i.offset)}),$(()=>{a.value&&(a.value.removeEventListener("scroll",T),null==H||H.unobserve(a.value),v.clientSize=0),r.value&&(null==H||H.unobserve(r.value),v.stickyHeaderSize=0),n.value&&(null==H||H.unobserve(n.value),v.stickyFooterSize=0),o.value&&(null==H||H.unobserve(o.value),v.headerSize=0),s.value&&(null==H||H.unobserve(s.value),v.footerSize=0)});const N=M([]);return D(()=>[h.inViewBegin,h.inViewEnd,c.value],(e,t)=>{if(e&&t){const[t]=e,a=h.renderBegin;let l=t,o=h.inViewEnd;if(l=Math.max(0,l-h.bufferTop),o=Math.min(o+h.bufferBottom,i.list.length-1>0?i.list.length-1:0),null==i?void 0:i.renderControl){const{begin:e,end:a}=i.renderControl(t,h.inViewEnd);l=e,o=a}h.renderBegin=l,h.renderEnd=o,l>a?h.virtualSize+=P(l,a):h.virtualSize-=P(l,a),N.value=i.list.slice(h.renderBegin,h.renderEnd+1)}},{immediate:!0}),D(()=>i.list.length,()=>{i.list.length<=0?F():(E(),x(h.inViewBegin),j(),V())},{immediate:!0}),{props:i,renderList:N,clientRefEl:a,listRefEl:l,headerRefEl:o,footerRefEl:s,stickyHeaderRefEl:r,stickyFooterRefEl:n,reactiveData:h,slotSize:v,sizesMap:d,resizeObserver:H,getReactiveData:function(){return h},getOffset:g,getSlotSize:function(){return v.headerSize+v.footerSize+v.stickyHeaderSize+v.stickyFooterSize},reset:F,scrollToIndex:_,manualRender:function(e,t){const a=h.renderBegin;h.renderBegin=e,h.renderEnd=t,e>a?h.virtualSize+=P(e,a):h.virtualSize-=P(e,a),N.value=i.list.slice(h.renderBegin,h.renderEnd+1),j()},scrollIntoView:async function(e){var t;const{top:a,bottom:l}=z(e),o=g(),s=g()+v.clientSize,r=b(null==(t=i.list[e])?void 0:t[i.itemKey]);a<o&&o<l&&r<v.clientSize?w(a):a+v.stickyHeaderSize<s&&s<l+v.stickyHeaderSize&&r<v.clientSize?w(l-v.clientSize+v.stickyHeaderSize):(a+v.stickyHeaderSize>=s||l<=o)&&_(e)},scrollToTop:async function(){let e=0;!function t(){e+=1,w(0),setTimeout(()=>{var l;if(e>10)return;const o=i.horizontal?"scrollLeft":"scrollTop";0!==(null==(l=null==a?void 0:a.value)?void 0:l[o])&&t()},3)}()},scrollToBottom:C,scrollToOffset:w,getItemSize:b,deleteItemSize:function(e){d.delete(String(e))},deletedList2Top:function(e){E();let t=0;e.forEach(e=>{t+=b(e[i.itemKey])}),j(),w(h.offset-t),B()},addedList2Top:function(e){E();let t=0;e.forEach(e=>{t+=b(e[i.itemKey])}),j(),w(h.offset+t),y=!0,p=!1,B()},getItemPosByIndex:z,forceUpdate:V}}const De=e({name:"VirtList",emits:{scroll:e=>e,toTop:e=>e,toBottom:e=>e,itemResize:(e,t)=>!0,rangeUpdate:(e,t)=>!0},props:{list:{type:Array,default:()=>[]},itemKey:{type:[String,Number],required:!0},minSize:{type:Number,default:20,required:!0},itemGap:{type:Number,default:0},renderControl:{type:Function,default:void 0},fixed:{type:Boolean,default:!1},buffer:{type:Number,default:0},bufferTop:{type:Number,default:0},bufferBottom:{type:Number,default:0},scrollDistance:{type:Number,default:0},horizontal:{type:Boolean,default:!1},start:{type:Number,default:0},offset:{type:Number,default:0},listStyle:{type:[String,Array,Object],default:""},listClass:{type:[String,Array,Object],default:""},itemStyle:{type:[String,Array,Object,Function],default:""},itemClass:{type:[String,Array,Object,Function],default:""},headerClass:{type:[String,Array,Object],default:""},headerStyle:{type:[String,Array,Object],default:""},footerClass:{type:[String,Array,Object],default:""},footerStyle:{type:[String,Array,Object],default:""},stickyHeaderClass:{type:[String,Array,Object],default:""},stickyHeaderStyle:{type:[String,Array,Object],default:""},stickyFooterClass:{type:[String,Array,Object],default:""},stickyFooterStyle:{type:[String,Array,Object],default:""}},setup:(e,t)=>Me(e,{scroll:e=>{t.emit("scroll",e)},toTop:e=>{t.emit("toTop",e)},toBottom:e=>{t.emit("toBottom",e)},itemResize:(e,i)=>{t.emit("itemResize",e,i)},rangeUpdate:(e,i)=>{t.emit("rangeUpdate",e,i)}}),render(){const{renderList:e,reactiveData:t,resizeObserver:i}=this,{itemGap:a,itemKey:l,horizontal:o,listStyle:s,listClass:r,itemStyle:n,itemClass:d,headerClass:c,headerStyle:u,footerClass:f,footerStyle:y,stickyHeaderClass:p,stickyHeaderStyle:m,stickyFooterClass:v,stickyFooterStyle:h}=this.props,{listTotalSize:g,virtualSize:k,renderBegin:b}=t;return Ee("div",{ref:"clientRefEl",class:"virt-list__client",style:"width: 100%; height: 100%; overflow: auto;",attrs:{"data-id":"client"}},[(()=>{var e;return Oe(this,"stickyHeader")?Ee("div",{key:"slot-sticky-header",class:p,style:$e("position: sticky; z-index: 10;",o?"left: 0":"top: 0;",m),ref:"stickyHeaderRefEl",attrs:{"data-id":"stickyHeader"}},[null==(e=Oe(this,"stickyHeader"))?void 0:e()]):null})(),(()=>{var e;return Oe(this,"header")?Ee("div",{key:"slot-header",class:c,style:u,ref:"headerRefEl",attrs:{"data-id":"header"}},[null==(e=Oe(this,"header"))?void 0:e()]):null})(),(()=>{var t,c;const u=[];for(let o=0;o<e.length;o+=1){const s=e[o];u.push(Re(Le,{key:s[l],class:"function"==typeof d?d(s,o):d,style:$e(a>0?`padding: ${a/2}px 0;`:"","function"==typeof n?n(s,o):n),attrs:{id:s[l],resizeObserver:i}},null==(t=Oe(this,"default"))?void 0:t({itemData:s,index:b+o})))}if(0===u.length&&Oe(this,"empty")){const e=this.slotSize.clientSize-this.getSlotSize();u.push(Ee("div",{key:`slot-empty-${e}`,style:`height: ${e}px`},[null==(c=Oe(this,"empty"))?void 0:c()]))}return Ee("div",{ref:"listRefEl",class:r,style:o?`will-change: width; min-width: ${g}px; display: flex; ${s}`:`will-change: height; min-height: ${g}px; ${s}`},[Ee("div",{style:o?`width: ${k}px; will-change: width;`:`height: ${k}px; will-change: height;`}),u])})(),(()=>{var e;return Oe(this,"footer")?Ee("div",{key:"slot-footer",class:f,style:y,ref:"footerRefEl",attrs:{"data-id":"footer"}},[null==(e=Oe(this,"footer"))?void 0:e()]):null})(),(()=>{var e;return Oe(this,"stickyFooter")?Ee("div",{key:"slot-sticky-footer",class:v,style:$e("position: sticky; z-index: 10;",o?"right: 0":"bottom: 0;",h),ref:"stickyFooterRefEl",attrs:{"data-id":"stickyFooter"}},[null==(e=Oe(this,"stickyFooter"))?void 0:e()]):null})()])}}),Fe=e({__name:"SongListMenu",emits:["removeSong"],setup(e,{expose:i,emit:l}){const o=l,r=ce(),n=t(),c=F(),u=a(),y=R(0),p=R(0),m=R(!1),v=R([]),h=(e,t,i)=>{e.path&&window.$dialog.warning({title:"确认删除",content:()=>E("div",{style:{marginTop:"20px"}},[E(U,{showIcon:!1},{default:()=>e.path}),E("div",{style:{marginTop:"20px"}},["确认从本地磁盘中删除 ",E("strong",null,e.name),"？该操作无法撤销！"])]),positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{await window.electron.ipcRenderer.invoke("delete-file",e.path)?(t.splice(i,1),c.deleteLocalSong(i),ue.removeSongIndex(i),window.$message.success(`${e.name} 删除成功`)):window.$message.error(`${e.name} 删除失败，请重试`)}})},g=(e,t)=>{window.$dialog.warning({title:"确认删除",content:`确认从云盘中删除 ${e.name}？该操作无法撤销！`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{200==(await ke(e.id)).code?(n.cloudPlayList.splice(t,1),n.setCloudPlayList(n.cloudPlayList),u.playIndex===t&&ue.nextOrPrev("next"),window.$message.success("删除成功")):window.$message.error("删除失败，请重试")}})},k=async e=>{if(!e?.id)return;const t=await K(e.id),i=t?.data?.[0],{id:a,type:l,size:o,br:s,md5:r}=i,n=await be(e?.name,l,o,Math.floor(s/1e3),r,a);if(200===n.code){const e=n?.data?.failed?.[0];-200!==e?.code?window.$message.success("导入成功"):window.$message.error(e?.msg||"导入失败，请重试")}else window.$message.error("导入失败，请重试")};return i({openDropdown:(e,t,i,a,l,s)=>{try{e.preventDefault(),m.value=!1;const d=n.userLikeData.playlists?.filter(e=>e.userId===n.userData.userId),c=!!i?.mv&&0!==i.mv,f="cloud"===r.currentRoute.value.name,b=!!i?.path,S=1===H(),z=u.playIndex===a,w=!!s&&d.some(e=>e.id===s);j().then(()=>{v.value=[{key:"play",label:"立即播放",props:{onClick:()=>ue.addNextSong(i,!0)},icon:P("Play",{size:18})},{key:"play-next",label:"下一首播放",show:!z&&!u.personalFmMode,props:{onClick:()=>ue.addNextSong(i,!1)},icon:P("PlayNext",{size:18})},{key:"playlist-add",label:"添加到歌单",props:{onClick:()=>me([i],b)},icon:P("AddList",{size:18})},{key:"mv",label:"观看 MV",show:"song"===l&&c,props:{onClick:()=>r.push({name:"video",query:{id:i.mv,type:"mv"}})},icon:P("Video",{size:18})},{key:"line-1",type:"divider"},{key:"more",label:"更多操作",icon:P("Menu",{size:18}),children:[{key:"code-name",label:`复制${"song"===l?"歌曲":"节目"}名称`,props:{onClick:()=>N(i.name)},icon:P("Copy",{size:18})},{key:"code-id",label:`复制${"song"===l?"歌曲":"节目"} ID`,show:!b,props:{onClick:()=>N(i.id)},icon:P("Copy",{size:18})},{key:"share",label:`分享${"song"===l?"歌曲":"节目"}链接`,show:!b,props:{onClick:()=>N(`https://music.163.com/#/${l}?id=${i.id}`,"已复制分享链接到剪切板")},icon:P("Share",{size:18})},{key:"line-2",type:"divider",show:b},{key:"meta-edit",label:"音乐标签编辑",show:b,props:{onClick:()=>{i.path&&ge(i)}},icon:P("EditNote",{size:20})}]},{key:"line-two",type:"divider"},{key:"cloud-import",label:"导入至云盘",show:!f&&S&&"song"===l&&!b,props:{onClick:()=>k(i)},icon:P("Cloud")},{key:"delete",label:"从歌单中删除",show:w&&S&&!f,props:{onClick:()=>q(s,[i.id],()=>o("removeSong",[i.id]))},icon:P("Delete")},{key:"cloud-delete",label:"从云盘中删除",show:f,props:{onClick:()=>g(i,a)},icon:P("Delete")},{key:"delete",label:"从本地磁盘中删除",show:b&&!z,props:{onClick:()=>h(i,t,a)},icon:P("Delete")},{key:"open-folder",label:"打开歌曲所在目录",show:b,props:{onClick:()=>window.electron.ipcRenderer.send("open-folder",i.path)},icon:P("SnippetFolder")},{key:"cloud-match",label:"云盘歌曲纠正",show:f,props:{onClick:()=>ve(i?.id,a)},icon:P("AutoFix")},{key:"search",label:"同名搜索",props:{onClick:()=>r.push({name:"search",query:{keyword:i.name}})},icon:P("Search")},{key:"download",label:"下载歌曲",show:!b&&"song"===l,props:{onClick:()=>he(i)},icon:P("Download")}],y.value=e.clientX,p.value=e.clientY,m.value=!0})}catch(d){console.error("右键菜单出现异常：",d),window.$message.error("右键菜单出现异常")}}}),(e,t)=>{const i=V;return s(),d(i,{x:f(y),y:f(p),show:f(m),options:f(v),class:"song-list-menu",placement:"bottom-start",trigger:"manual",size:"large",onSelect:t[0]||(t[0]=e=>m.value=!1),onClickoutside:t[1]||(t[1]=e=>m.value=!1)},null,8,["x","y","show","options"])}}}),Ve={class:"list-header song-card"},He={class:"title has-sort"},je={class:"load-more"},Pe={key:1,class:"song-list loading"},Ne=A(e({__name:"SongList",props:{data:{},type:{default:"song"},height:{},loading:{type:Boolean},loadMore:{type:Boolean},loadingText:{default:"努力加载中..."},hiddenAlbum:{type:Boolean},hiddenCover:{type:Boolean},hiddenSize:{type:Boolean},hiddenScrollbar:{type:Boolean},disabledSort:{type:Boolean},playListId:{default:0}},emits:["reachBottom","scroll","removeSong"],setup(e,{emit:t}){const l=e,g=t,k=i(),b=a(),S=R(0),z=R(0),w=R(null),_=R(null),C=R(!0),x=R(null),T=G(()=>{const e=Z(l.data);if(l.disabledSort)return e;switch(b.listSort){case"titleAZ":return e.sort((e,t)=>e.name.localeCompare(t.name));case"titleZA":return e.sort((e,t)=>t.name.localeCompare(e.name));case"arAZ":return e.sort((e,t)=>{const i=Array.isArray(e.artists)?e.artists[0].name:e.artists,a=Array.isArray(t.artists)?t.artists[0].name:t.artists;return i.localeCompare(a)});case"arZA":return e.sort((e,t)=>{const i=Array.isArray(e.artists)?e.artists[0].name:e.artists;return(Array.isArray(t.artists)?t.artists[0].name:t.artists).localeCompare(i)});case"timeDown":return e.sort((e,t)=>t.duration-e.duration);case"timeUp":return e.sort((e,t)=>e.duration-t.duration);case"dateDown":return e.sort((e,t)=>(t.updateTime||0)-(e.updateTime||0));case"dateUp":return e.sort((e,t)=>(e.updateTime||0)-(t.updateTime||0));default:return e}}),A=G(()=>T.value.findIndex(e=>e.id===k.playSong.id)),{height:E,stop:O}=Y(_),L=G(()=>Q(X).map(([e,{name:t,show:i,icon:a}])=>({key:e,label:t,show:"all"===i||i===l.type,icon:P(a)}))),I=e=>{g("scroll",e),z.value=e.target.scrollTop},M=e=>{l.loading||g("reachBottom",e)},D=e=>{b.listSort=e,k.playPlaylistId===l.playListId&&ue.updatePlayList(T.value,k.playSong,l.playListId,{showTip:!1,play:!1,scrobble:!1}),w.value?.scrollToIndex(A.value||0)},F=e=>g("removeSong",e);return Se(()=>{S.value=w.value?.getOffset()||0,C.value=!1}),J(()=>{C.value=!0,"auto"===l.height&&O(),S.value>0&&w.value?.scrollToOffset(S.value)}),$(()=>{O(),C.value=!1}),(e,t)=>{const i=y,a=V,l=Ae,g=ae,k=ie,R=le,O=h,$=re,H=se,j=ne,P=de;return s(),d(ee,{name:"fade",mode:"out-in"},{default:p(()=>[f(W)(f(T))?e.loading?(s(),o("div",Pe,[c(j,{repeat:10,text:""})])):(s(),d(P,{key:2,description:"列表光秃秃的，啥都没有哦",size:"large",class:"song-list empty"})):(s(),o("div",{key:0,ref_key:"songListRef",ref:_,class:B(["song-list",{"hidden-scrollbar":e.hiddenScrollbar}])},[c(ee,{name:"fade",mode:"out-in"},{default:p(()=>[(s(),d(f(De),{ref_key:"listRef",ref:w,key:f(T)?.[0]?.id,list:f(T),minSize:94,buffer:2,offset:f(S),style:te({height:"auto"===e.height?"auto":`${e.height||f(E)}px`}),itemKey:"id",onScroll:I,onToBottom:M},{stickyHeader:p(()=>[r("div",Ve,[c(i,{class:"num"},{default:p(()=>t[2]||(t[2]=[m("#")])),_:1,__:[2]}),e.disabledSort?(s(),d(i,{key:1,class:"title"},{default:p(()=>t[4]||(t[4]=[m("标题")])),_:1,__:[4]})):(s(),d(a,{key:0,options:f(L),trigger:"click",placement:"bottom-start",onSelect:D},{default:p(()=>[r("div",He,[c(i,null,{default:p(()=>t[3]||(t[3]=[m("标题")])),_:1,__:[3]}),"default"!==f(b).listSort?(s(),d(i,{key:0,class:"sort",depth:"3"},{default:p(()=>[m(v(f(X)[f(b).listSort].name),1)]),_:1})):n("",!0)])]),_:1},8,["options"])),"radio"===e.type||e.hiddenAlbum?n("",!0):(s(),d(i,{key:2,class:"album"},{default:p(()=>t[5]||(t[5]=[m("专辑")])),_:1,__:[5]})),"radio"!==e.type?(s(),d(i,{key:3,class:"actions"},{default:p(()=>t[6]||(t[6]=[m("操作")])),_:1,__:[6]})):n("",!0),"radio"===e.type?(s(),d(i,{key:4,class:"meta date"},{default:p(()=>t[7]||(t[7]=[m("更新日期")])),_:1,__:[7]})):n("",!0),"radio"===e.type?(s(),d(i,{key:5,class:"meta"},{default:p(()=>t[8]||(t[8]=[m("播放量")])),_:1,__:[8]})):n("",!0),c(i,{class:"meta"},{default:p(()=>t[9]||(t[9]=[m("时长")])),_:1,__:[9]}),e.data?.[0].size&&!e.hiddenSize?(s(),d(i,{key:6,class:"meta size"},{default:p(()=>t[10]||(t[10]=[m("大小")])),_:1,__:[10]})):n("",!0)])]),default:p(({itemData:t,index:i})=>[c(l,{song:t,index:i,hiddenCover:e.hiddenCover,hiddenAlbum:e.hiddenAlbum,hiddenSize:e.hiddenSize,onDblclick:u(i=>f(ue).updatePlayList(f(T),t,e.playListId),["stop"]),onContextmenu:u(a=>f(x)?.openDropdown(a,f(T),t,i,e.type,e.playListId),["stop"])},null,8,["song","index","hiddenCover","hiddenAlbum","hiddenSize","onDblclick","onContextmenu"])]),footer:p(()=>[r("div",je,[e.loadMore&&e.loading?(s(),d(k,{key:0},{default:p(()=>[c(g,{size:"small"}),c(i,null,{default:p(()=>[m(v(e.loadingText||"努力加载中"),1)]),_:1})]),_:1})):(s(),d(R,{key:1,dashed:""},{default:p(()=>t[11]||(t[11]=[m(" 没有更多啦 ~ ")])),_:1,__:[11]}))])]),_:1},8,["list","offset","style"]))]),_:1}),c(Fe,{ref_key:"songListMenuRef",ref:x,onRemoveSong:F},null,512),(s(),d(oe,{to:"body"},[c(ee,{name:"fade",mode:"out-in"},{default:p(()=>[f(C)?(s(),d(H,{key:0,class:"list-menu"},{default:p(()=>[c(ee,{name:"fade",mode:"out-in"},{default:p(()=>[f(z)>100?(s(),d($,{key:0,width:"42",onClick:t[0]||(t[0]=e=>f(w)?.scrollToTop())},{default:p(()=>[c(O,{size:22,name:"Up"})]),_:1})):n("",!0)]),_:1}),f(A)>=0?(s(),d($,{key:0,width:"42",onClick:t[1]||(t[1]=e=>f(w)?.scrollToIndex(f(A)))},{default:p(()=>[c(O,{size:22,name:"Location"})]),_:1})):n("",!0)]),_:1})):n("",!0)]),_:1})]))],2))]),_:1})}}}),[["__scopeId","data-v-ddf3e382"]]);export{Ne as _};
