import{d as a,dc as e,u as l,r as s,f as t,bI as o,Z as n,di as u,dj as c,aR as i,cW as d,aZ as r,w as f,o as m,cn as g,bM as p,H as _,j as h,J as v,n as b,m as w,a7 as y,ai as k,a5 as P,ce as S,k as x,ar as F,bN as C,i as $,a6 as j,c5 as L,af as R,aq as z,ao as D,au as I,cF as U,ae as q,cq as A,cr as B,b1 as M,b2 as K,b3 as N,bb as Z,aA as G,aB as H,bz as J,ck as V,K as W}from"./stores-fvLrIm8G.js";import{u as E,d as O,o as Q,p as T}from"./index-CugtlCeX.js";const X={class:"local"},Y={class:"title"},aa=W(a({__name:"layout",setup(a){const W=E(),aa=e(),ea=l(),la=s(!0),sa=s(null),ta=r("local"),oa=s(W.currentRoute.value?.name||"local-songs"),na=s(""),ua=s([]),ca=s(""),ia=s(!1),da=t(()=>na.value&&ua.value.length?ua.value:aa.localSongs),ra=t(()=>{const a=aa.localSongs.reduce((a,e)=>a+(e?.size||0),0);return Number((a/1024).toFixed(2))}),fa=t(()=>[{label:"本地目录管理",key:"folder",props:{onClick:()=>ia.value=!0},icon:o("FolderCog")},{label:"批量操作",key:"batch",props:{onClick:()=>O(da.value,!0)},icon:o("Batch")}]),ma=n(async(a=!1)=>{const e=await(async()=>(ca.value=await window.electron.ipcRenderer.invoke("get-default-dir","music"),[ea.showDefaultLocalPath?ca.value:"",...ea.localFilesPath]))();if(!e||!e.length)return;a&&(sa.value=window.$message.loading("正在获取本地歌曲",{duration:0})),la.value=!0;const l=e.map(a=>window.electron.ipcRenderer.invoke("get-music-files",a)),s=(await Promise.allSettled(l)).filter(a=>"fulfilled"===a.status).map(a=>a.value),t=u(c(s),"id"),o=i(t),n=aa.localSongs.length;0===n&&o.length>0?window.$message.success(`发现 ${o.length} 首歌曲`):o.length>n&&window.$message.success(`新增 ${o.length-n} 首歌曲`),a&&window.$message.success(`已发现 ${o.length} 首`),aa.updateLocalSong(o),la.value=!1,sa.value?.destroy(),sa.value=null},300,{leading:!0,trailing:!1}),ga=n(a=>{if(!(a=a.trim())||""===a)return;const e=d(a,aa.localSongs);ua.value=e},300);return ta.on(()=>ma()),f(()=>[ea.localFilesPath,ea.showDefaultLocalPath],async()=>await ma(),{deep:!0}),Q(a=>{"local"===a.matched[0].name&&(oa.value=a.name)}),m(ma),(a,e)=>{const l=k,s=P,t=S,o=F,n=j,u=L,c=z,i=U,d=I,r=g("RouterView"),f=Z,m=N,E=K,O=M,Q=V,sa=p("debounce");return h(),_("div",X,[v("div",Y,[b(l,{class:"keyword"},{default:w(()=>e[7]||(e[7]=[y("本地歌曲")])),_:1,__:[7]}),b(o,{class:"status"},{default:w(()=>[b(l,{class:"item"},{default:w(()=>[b(s,{name:"Music",depth:3}),b(t,{from:0,to:x(aa).localSongs?.length||0},null,8,["to"]),e[8]||(e[8]=y(" 首歌曲 "))]),_:1,__:[8]}),b(l,{class:"item"},{default:w(()=>[b(s,{name:"Storage",depth:3}),b(t,{from:0,to:x(ra),precision:2},null,8,["to"]),e[9]||(e[9]=y(" GB "))]),_:1,__:[9]})]),_:1})]),b(o,{class:"menu",justify:"space-between"},{default:w(()=>[b(o,{class:"left",align:"flex-end"},{default:w(()=>[C((h(),$(n,{focusable:!1,disabled:x(la)&&!x(aa).localSongs?.length,loading:x(la),type:"primary",strong:"",secondary:"",round:""},{icon:w(()=>[b(s,{name:"Play"})]),default:w(()=>[e[10]||(e[10]=y(" 播放 "))]),_:1,__:[10]},8,["disabled","loading"])),[[sa,()=>x(T).updatePlayList(x(da))]]),b(n,{focusable:!1,class:"more",strong:"",secondary:"",circle:"",onClick:e[0]||(e[0]=a=>x(ma)(!0))},{icon:w(()=>[b(s,{name:"Refresh"})]),_:1}),b(u,{options:x(fa),trigger:"click",placement:"bottom-start"},{default:w(()=>[b(n,{focusable:!1,class:"more",circle:"",strong:"",secondary:""},{icon:w(()=>[b(s,{name:"List"})]),_:1})]),_:1},8,["options"])]),_:1}),b(o,{class:"right",justify:"end"},{default:w(()=>[x(aa).localSongs?.length?(h(),$(c,{key:0,value:x(na),"onUpdate:value":e[1]||(e[1]=a=>D(na)?na.value=a:null),"input-props":{autocomplete:"off"},class:"search",placeholder:"模糊搜索",clearable:"",round:"",onInput:x(ga)},{prefix:w(()=>[b(s,{name:"Search"})]),_:1},8,["value","onInput"])):R("",!0),b(d,{value:x(oa),"onUpdate:value":[e[2]||(e[2]=a=>D(oa)?oa.value=a:null),e[3]||(e[3]=a=>x(W).push({name:a}))],class:"tabs",type:"segment"},{default:w(()=>[b(i,{name:"local-songs"},{default:w(()=>e[11]||(e[11]=[y(" 单曲 ")])),_:1,__:[11]}),b(i,{disabled:0===x(da).length,name:"local-artists"},{default:w(()=>e[12]||(e[12]=[y(" 歌手 ")])),_:1,__:[12]},8,["disabled"]),b(i,{disabled:0===x(da).length,name:"local-albums"},{default:w(()=>e[13]||(e[13]=[y(" 专辑 ")])),_:1,__:[13]},8,["disabled"])]),_:1},8,["value"])]),_:1})]),_:1}),b(r,null,{default:w(({Component:a})=>[b(q,{name:`router-${x(ea).routeAnimation}`,mode:"out-in"},{default:w(()=>[x(ea).useKeepAlive?(h(),$(A,{key:0},[(h(),$(B(a),{data:x(da),loading:x(la),class:"router-view"},null,8,["data","loading"]))],1024)):(h(),$(B(a),{key:1,data:x(da),loading:x(la),class:"router-view"},null,8,["data","loading"]))]),_:2},1032,["name"])]),_:1}),b(Q,{show:x(ia),"onUpdate:show":e[6]||(e[6]=a=>D(ia)?ia.value=a:null),"close-on-esc":!1,"mask-closable":!1,preset:"card",title:"目录管理","transform-origin":"center",style:{width:"600px"}},{footer:w(()=>[b(o,{justify:"center"},{default:w(()=>[b(n,{class:"add-path",strong:"",secondary:"",onClick:e[5]||(e[5]=a=>x(J)())},{icon:w(()=>[b(s,{name:"FolderPlus"})]),default:w(()=>[e[15]||(e[15]=y(" 添加文件夹 "))]),_:1,__:[15]})]),_:1})]),default:w(()=>[b(O,{class:"local-list",hoverable:"",clickable:"",bordered:""},{header:w(()=>[b(l,null,{default:w(()=>e[14]||(e[14]=[y("请选择本地音乐文件夹，将自动扫描您添加的目录，歌曲增删实时同步")])),_:1,__:[14]})]),default:w(()=>[x(ca)?(h(),$(E,{key:0},{prefix:w(()=>[b(s,{size:20,name:"FolderMusic"})]),suffix:w(()=>[b(f,{value:x(ea).showDefaultLocalPath,"onUpdate:value":e[4]||(e[4]=a=>x(ea).showDefaultLocalPath=a),round:!1,class:"set"},null,8,["value"])]),default:w(()=>[b(m,{title:x(ca),description:"系统默认音乐文件夹"},null,8,["title"])]),_:1})):R("",!0),(h(!0),_(G,null,H(x(ea).localFilesPath,(a,e)=>(h(),$(E,{key:e},{prefix:w(()=>[b(s,{size:20,name:"Folder"})]),suffix:w(()=>[b(n,{quaternary:"",onClick:a=>x(J)(e)},{icon:w(()=>[b(s,{size:20,name:"Delete"})]),_:2},1032,["onClick"])]),default:w(()=>[b(m,{title:a},null,8,["title"])]),_:2},1024))),128))]),_:1})]),_:1},8,["show"])])}}}),[["__scopeId","data-v-266e8813"]]);export{aa as default};
