import{_ as a}from"./SongList-CDQnjgGa.js";import{d as e,as as l,b as s,L as t,r as o,f as i,bI as n,d0 as r,cy as d,d1 as u,aR as c,Z as v,cW as m,T as p,S as g,R as f,o as h,H as y,j as _,n as b,m as k,k as w,J as T,ag as j,ah as x,cN as L,cT as I,a7 as S,a8 as C,b9 as R,i as $,af as q,cl as z,ar as H,a5 as N,ai as P,cV as B,aA as F,aB as U,aI as A,a6 as D,d2 as J,c5 as K,aq as M,ao as O,aj as V,ae as W,b4 as Z,ac as E,K as G}from"./stores-fvLrIm8G.js";import{u as Q,p as X,o as Y,b as aa}from"./index-CugtlCeX.js";const ea={key:0,class:"detail"},la={class:"cover"},sa={class:"data"},ta={class:"item"},oa={class:"item"},ia={key:0,class:"item"},na={key:1,class:"item"},ra={key:2,class:"item"},da={key:1,class:"detail"},ua={class:"data"},ca=G(e({__name:"radio",setup(e){const G=Q(),ca=l(),va=s(),ma=t([]),pa=o(null),ga=o(""),fa=o([]),ha=o(0),ya=i(()=>Number(G.currentRoute.value.query.id)),_a=o(!0),ba=o(null),ka=o(!1),wa=i(()=>ga.value?fa.value:ma.value),Ta=i(()=>va.mainContentHeight-(ka.value?120:240)),ja=i(()=>ca.userLikeData.djs.some(a=>a.id===pa.value?.id)),xa=i(()=>"radio"===G.currentRoute.value.name),La=i(()=>ha.value===ya.value),Ia=i(()=>[{label:"刷新播客",key:"refresh",props:{onClick:()=>Sa(ya.value)},icon:n("Refresh")},{label:"打开源页面",key:"open",props:{onClick:()=>{window.open(`https://music.163.com/#/djradio?id=${ya.value}`)}},icon:n("Link")}]),Sa=async a=>{if(!a)return;_a.value=!0,$a(),pa.value=null;const e=await r(a);pa.value=d(e.data)[0],await Ca(a,pa.value?.count)},Ca=async(a,e)=>{if(!a||!e)return;_a.value=!0,ma.value=[],e>500&&qa();let l=0;do{const e=await u(a,500,l),s=c(e.programs);ma.value=ma.value.concat(s),l+=500}while(l<e&&xa.value);qa(!1)},Ra=a=>{const e=a.target.scrollTop;ka.value=e>10},$a=()=>{ga.value="",fa.value=[]},qa=(a=!0)=>{a?(ba.value?.destroy(),ba.value=window.$message.loading("该播客节目数量过多，请稍等",{duration:0,closable:!0})):(_a.value=!1,ba.value?.destroy(),ba.value=null)},za=v(()=>{pa.value&&ma.value?.length&&X.updatePlayList(ma.value,void 0,ya.value)},300),Ha=v(a=>{if(!(a=a.trim())||""===a)return;const e=m(a,ma.value);fa.value=e},300);return Y(a=>{const e=Number(a.query.id);e&&(ha.value=e,Sa(e))}),p(()=>{if(0===ha.value)ha.value=ya.value;else{const a=ha.value===ya.value;ha.value=ya.value,a||Sa(ya.value)}}),g(()=>qa(!1)),f(()=>qa(!1)),h(()=>Sa(ya.value)),(e,l)=>{const s=j,t=I,o=z,i=N,n=P,r=A,d=H,u=R,c=D,v=K,m=M,p=V,g=a,f=Z;return _(),y("div",{class:E(["playlist",{small:w(ka)}])},[b(W,{name:"fade",mode:"out-in"},{default:k(()=>[w(pa)?(_(),y("div",ea,[T("div",la,[b(s,{src:w(pa).coverSize?.m||w(pa).cover,"previewed-img-props":{style:{borderRadius:"8px"}},"preview-src":w(pa).cover,renderToolbar:w(L),"show-toolbar-tooltip":"",class:"cover-img",onLoad:w(x)},{placeholder:k(()=>l[2]||(l[2]=[T("div",{class:"cover-loading"},[T("img",{src:aa,class:"loading-img",alt:"loading-img"})],-1)])),_:1},8,["src","preview-src","renderToolbar","onLoad"]),b(s,{class:"cover-shadow","preview-disabled":"",src:w(pa).coverSize?.m||w(pa).cover},null,8,["src"])]),T("div",sa,[b(t,{class:"name text-hidden"},{default:k(()=>[S(C(w(pa).name||"未知播客"),1)]),_:1}),b(u,{show:!w(ka),class:"collapse"},{default:k(()=>[w(pa).description?(_(),$(o,{key:0,"line-clamp":1,tooltip:{trigger:"click",placement:"bottom",width:"trigger"}},{default:k(()=>[S(C(w(pa).description),1)]),_:1})):q("",!0),b(d,{class:"meta"},{default:k(()=>[T("div",ta,[b(i,{name:"Person",depth:3}),b(n,null,{default:k(()=>[S(C(w(pa).creator?.name||"未知用户名"),1)]),_:1})]),T("div",oa,[b(i,{name:"Music",depth:3}),b(n,null,{default:k(()=>[S(C(w(pa).count||0),1)]),_:1})]),w(pa).updateTime?(_(),y("div",ia,[b(i,{name:"Update",depth:3}),b(n,null,{default:k(()=>[S(C(w(pa).updateTime),1)]),_:1})])):w(pa).createTime?(_(),y("div",na,[b(i,{name:"Time",depth:3}),b(n,null,{default:k(()=>[S(C(w(B)(w(pa).createTime)),1)]),_:1})])):q("",!0),w(pa).tags?.length?(_(),y("div",ra,[b(i,{name:"Tag",depth:3}),b(d,{class:"tags"},{default:k(()=>[(_(!0),y(F,null,U(w(pa).tags,(a,e)=>(_(),$(r,{key:e,bordered:!1,round:""},{default:k(()=>[S(C(a),1)]),_:2},1024))),128))]),_:1})])):q("",!0)]),_:1})]),_:1},8,["show"]),b(d,{class:"menu",justify:"space-between"},{default:k(()=>[b(d,{class:"left",align:"flex-end"},{default:k(()=>[b(c,{focusable:!1,disabled:w(_a),loading:w(_a),type:"primary",strong:"",secondary:"",round:"",onClick:w(za)},{icon:k(()=>[b(i,{name:"Play"})]),default:k(()=>[S(" "+C(w(_a)?w(La)?"更新中...":`加载中... (${w(ma).length===w(pa).count?0:w(ma).length}/${w(pa).count})`:"播放"),1)]),_:1},8,["disabled","loading","onClick"]),b(c,{focusable:!1,strong:"",secondary:"",round:"",onClick:l[0]||(l[0]=a=>w(J)(w(ya),!w(ja)))},{icon:k(()=>[b(i,{name:w(ja)?"Favorite":"FavoriteBorder"},null,8,["name"])]),default:k(()=>[S(" "+C(w(ja)?"取消订阅":"订阅播客"),1)]),_:1}),b(v,{options:w(Ia),trigger:"click",placement:"bottom-start"},{default:k(()=>[b(c,{focusable:!1,class:"more",circle:"",strong:"",secondary:""},{icon:k(()=>[b(i,{name:"List"})]),_:1})]),_:1},8,["options"])]),_:1}),b(d,{class:"right"},{default:k(()=>[w(ma)?.length?(_(),$(m,{key:0,value:w(ga),"onUpdate:value":l[1]||(l[1]=a=>O(ga)?ga.value=a:null),"input-props":{autocomplete:"off"},class:"search",placeholder:"模糊搜索",clearable:"",round:"",onInput:w(Ha)},{prefix:k(()=>[b(i,{name:"Search"})]),_:1},8,["value","onInput"])):q("",!0)]),_:1})]),_:1})])])):(_(),y("div",da,[b(p,{class:"cover"}),T("div",ua,[b(p,{repeat:4,text:""})])]))]),_:1}),b(W,{name:"fade",mode:"out-in"},{default:k(()=>[!w(ga)||w(fa)?.length?(_(),$(g,{key:0,data:w(wa),loading:w(_a),height:w(Ta),radioId:w(ya),type:"radio",onScroll:Ra},null,8,["data","loading","height","radioId"])):(_(),$(f,{key:1,description:`搜不到关于 ${w(ga)} 的任何歌曲呀`,style:{"margin-top":"60px"},size:"large"},{icon:k(()=>[b(i,{name:"SearchOff"})]),_:1},8,["description"]))]),_:1})],2)}}}),[["__scopeId","data-v-3a9ab135"]]);export{ca as default};
